<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"><title data-react-helmet="true">Midterm Project | EN.601.220: Intermediate Programming</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Midterm Project | EN.601.220: Intermediate Programming"><meta data-react-helmet="true" name="description" content="* You are expected to work as a team of two."><meta data-react-helmet="true" property="og:description" content="* You are expected to work as a team of two."><meta data-react-helmet="true" property="og:url" content="https://jhu-ip.github.io/cs220-sp21/docs/assignments/midterm"><link data-react-helmet="true" rel="shortcut icon" href="/cs220-sp21/img/logo_cpp.svg"><link data-react-helmet="true" rel="canonical" href="https://jhu-ip.github.io/cs220-sp21/docs/assignments/midterm"><link rel="stylesheet" href="/cs220-sp21/styles.c480a4bb.css">
<link rel="preload" href="/cs220-sp21/styles.a74149fa.js" as="script">
<link rel="preload" href="/cs220-sp21/runtime~main.6fca5550.js" as="script">
<link rel="preload" href="/cs220-sp21/main.30419887.js" as="script">
<link rel="preload" href="/cs220-sp21/1.c4127283.js" as="script">
<link rel="preload" href="/cs220-sp21/2.4f001a13.js" as="script">
<link rel="preload" href="/cs220-sp21/54.75b9ba21.js" as="script">
<link rel="preload" href="/cs220-sp21/55.349af7d3.js" as="script">
<link rel="preload" href="/cs220-sp21/f976f453.8850f580.js" as="script">
<link rel="preload" href="/cs220-sp21/17896441.2b62ceab.js" as="script">
<link rel="preload" href="/cs220-sp21/5da55f63.5b2c6c92.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top navbarHideable_3046"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/cs220-sp21/"><img class="navbar__logo" src="/cs220-sp21/img/logo_cpp.svg" alt="CS220"><strong class="navbar__title">CS220</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cs220-sp21/docs">Syllabus</a><a class="navbar__item navbar__link" href="/cs220-sp21/staff/">Course Staff</a><a href="https://docs.google.com/spreadsheets/d/1OCSl2UKclPT7asoEoSwNgRdAoJnRbQPbonDbS89JV7Q/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CA Office Hours</a><a class="navbar__item navbar__link" href="/cs220-sp21/materials/">Course Material</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a href="#" class="navbar__item navbar__link">Assignments</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cs220-sp21/docs/assignments/hw0">Homework 0</a></li><li><a class="dropdown__link" href="/cs220-sp21/docs/assignments/hw1">Homework 1</a></li><li><a href="https://www.gradescope.com/courses/230194/assignments/1006756" target="_blank" rel="noopener noreferrer" class="dropdown__link">Homework 2</a></li><li><a class="dropdown__link" href="/cs220-sp21/docs/assignments/hw3">Homework 3</a></li><li><a href="https://www.gradescope.com/courses/230194/assignments/1029598" target="_blank" rel="noopener noreferrer" class="dropdown__link">Homework 4</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a href="#" class="navbar__item navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cs220-sp21/docs/resources/github-ssh">Github ssh authentication</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/cs220-sp21/"><img class="navbar__logo" src="/cs220-sp21/img/logo_cpp.svg" alt="CS220"><strong class="navbar__title">CS220</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/cs220-sp21/docs">Syllabus</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/staff/">Course Staff</a></li><li class="menu__list-item"><a href="https://docs.google.com/spreadsheets/d/1OCSl2UKclPT7asoEoSwNgRdAoJnRbQPbonDbS89JV7Q/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="menu__link">CA Office Hours</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/materials/">Course Material</a></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist">Assignments</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/assignments/hw0">Homework 0</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/assignments/hw1">Homework 1</a></li><li class="menu__list-item"><a href="https://www.gradescope.com/courses/230194/assignments/1006756" target="_blank" rel="noopener noreferrer" class="menu__link">Homework 2</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/assignments/hw3">Homework 3</a></li><li class="menu__list-item"><a href="https://www.gradescope.com/courses/230194/assignments/1029598" target="_blank" rel="noopener noreferrer" class="menu__link">Homework 4</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/resources/github-ssh">Github ssh authentication</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Midterm Project</h1></header><div class="markdown"><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><ul><li>You are expected to work as a team of two.</li><li><strong>Due: Tuesday <strong>March 25th</strong> at 11pm EDT (Baltimore time).</strong></li><li>No late days are allowed!</li></ul></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="introduction"></a>Introduction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#introduction" title="Direct link to heading">#</a></h1><p>In this project you will implement programs to generate and transform
digital audio.</p><p>This is a pair project, so you will work with one classmate.  You should
practice pair programming where you work directly with you partner, in
person, to design and implement the program.  We will spend some time in
class working on the project, so your partner needs to be in your section.</p><p>You will use git for version control.  <em>TODO: how repo will be created,
accessed.</em></p><p>The project is larger and more complex than the previous homework
assignments.  Youâ€™ll want to start early and make steady, incremental
progress towards completing the project requirements.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="getting-started"></a>Getting started<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h2><p><em>TODO: details about getting started, setting up repo, etc.</em></p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="sound"></a>Sound<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sound" title="Direct link to heading">#</a></h1><p>This section has some background about sound and how it can be represented digitally.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="what-sound-is"></a>What sound is<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-sound-is" title="Direct link to heading">#</a></h2><p>Sound is changes in air pressure over time.  When physical objects
vibrate, they cause oscillations in air pressure that propagate outwards
in a wave.  A sensor such as a microphone or your ear can detect these
changes in pressure over time.</p><p>The most basic type of oscillation is a sine wave, where the changes in
pressure over time are modeled by the equation</p><p><em>p</em> = <em>a</em> Ã— sin(<em>tf</em> Ã— 2Ï€)</p><p>where <em>p</em> is pressure, <em>t</em> is time, <em>f</em> is frequency, and <em>a</em> is
amplitude.  Because the sine function yields both positive and negative
values, the resulting pressure values (<em>p</em>) can be both positive and
negative.  The pressure values represent the instantaneous air pressure
relative to the overall average air pressure.</p><p>Plotted with time on the x-axis and pressure on the y-axis, a sine wave
looks like this:</p><p><img alt="Sine wave" src="/cs220-sp21/assets/images/sound-sinewave-852e6c6a751de54a079f42afd2f270a1.png"></p><p>A <em>cycle</em> consists of one full oscillation with both positive and negative peaks:</p><p><img alt="Sine wave cycle" src="/cs220-sp21/assets/images/sound-sinewave-cycles-2c4fc7ee671d8fba7ee1cd002fe2528e.png"></p><p>When the frequency increases, the cycles become shorter, so there are more
cycles per unit of time.  The standard measurement of frequency, the Hertz
(abbreviated Hz), is defined as one cycle per second.  Sound waves have
frequencies that range from the low tens of Hz to tens of thousands of Hz.
We perceive sounds with higher frequencies as being higher-pitched.</p><p>Here is what one second of a 440 Hz sine wave sounds like:</p><audio controls=""><source src="../../snd/a440.wav" type="audio/wav"></audio><div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="complex-audio-waveforms"></a>Complex audio waveforms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#complex-audio-waveforms" title="Direct link to heading">#</a></h3><p>Obviously real sounds are much more complex than just plain sine waves.
In general, any sound can be represented by the <em>sum</em> of sine waves of
varying frequencies and amplitudes.  Here is one second of a 440 Hz sine
wave mixed with a 587.33 Hz sine wave:</p><audio controls=""><source src="../../snd/a440_third.wav" type="audio/wav"></audio><div></div><p>At a physical level, the air pressure changes as the <em>sum</em> of the pressure
changes induced by all of the sine waves being generated.  Humans can
effectively hear multiple tones at the same time, deconstructing the
added sine waves into the constituent frequencies.  The example you just
heard (440 Hz and 587.33 Hz) is two tones separated by a <em>major third</em>,
an important frequency interval in western music.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="digital-sound"></a>Digital sound<a aria-hidden="true" tabindex="-1" class="hash-link" href="#digital-sound" title="Direct link to heading">#</a></h3><p>There are a variety of ways to represent sound using a computer.
The most straightforward way is using linear <a href="https://en.wikipedia.org/wiki/Pulse-code_modulation" target="_blank" rel="noopener noreferrer">pulse code
modulation</a>,
where sound is represented as a sequence of <em>samples</em>, each sample
representing air pressure at a moment in time.  The <em>sampling frequency</em>
determines how many (evenly spaced) samples there are per unit of time.
CD quality audio, a common PCM format, uses signed 16 bit samples
(ranging from -32,768 to 32,767) and a sampling frequency of 44.1 KHz
(44,100 samples per second.)  In C, the <code>int16_t</code> data type (defined in
the <code>&lt;stdint.h&gt;</code> header file) matches the range of sample data values
for CD quality audio.  So, an array of <code>int16_t</code> elements can represent
CD quality audio: each 44,100 elements represents one second of (monaural) audio.</p><p>To make this idea explicit, let&#x27;s say that the sound we want to represent
is a sine wave with an amplitude of 0.1 and a frequency of 440 Hz.
We&#x27;ll consider amplitude as being relative to the loudest possible sound,
defined as 1.0, so a signal with an amplitude of 0.1 has positive and
negative peaks that are 10% as large as the loudest possible signal.
With a sampling frequency of 44.1 KHz, each cycle of our 440 Hz audio
signal will be represented by about 100 samples (really 100.22727...).  The values of the
individual samples will vary between (approximately) -3,276 and 3,276.
Let&#x27;s say the audio data is in an array of <code>int16_t</code> elements called
<code>sound</code>.  Here is a diagram showing several points on the first cycle
of the signal, their values, and which array elements they would be
stored in:</p><p><img alt="Sine wave with samples" src="/cs220-sp21/assets/images/sound-sinewave-samples-836e8f3c7a1ca1c2e71bd0fd27d6a69c.png"></p><p>As long as the number of bits per sample is reasonably large, and the
sampling frequency is reasonably high, PCM can represent audio with a
high degree of fidelity to the original sound.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="mixing-digital-audio-signals-clipping"></a>Mixing digital audio signals, clipping<a aria-hidden="true" tabindex="-1" class="hash-link" href="#mixing-digital-audio-signals-clipping" title="Direct link to heading">#</a></h3><p>Because sound waves interact additively, you can combine two digital
audio signals by simply <em>adding</em> their respective sample values.</p><p>A potential problem that can arise when adding sample values is that
the sum might exceed the maximum positive or negative sample values: for
example, 32,767 and -32,768 for 16 bit signed samples.  If this happens,
we can&#x27;t really fully represent the resulting combined signal.  <em>Clipping</em>
is a phenomenon that results from such overflows, in particular, when we
use <em>saturating</em> addition such that sums greater than the maximum possible
value or less than the minimum possible value (e.g., 32,767/-32,768)
are <em>clamped</em> at the maximum or minimum.</p><p>For example, here is an audio signal where the amplitude exceeds the
range that can be represented, with the minimum and maximum sample values
shown as light blue dashed lines:</p><p><img alt="Audio signal before clipping" src="/cs220-sp21/assets/images/sound-noclip-8a2e991ca0e77b1449e3d2bf8beba436.png"></p><p>Clipping will change the waveform to the following:</p><p><img alt="Audio signal after clipping" src="/cs220-sp21/assets/images/sound-clip-f35397ef050673b7eb36adc61136cec1.png"></p><p>Humans perceive clipping as distortion of the original signals.
Clipping can be avoided by making sure that audio signals being mixed
have relatively small amplitudes, so that the sum of their sample values
never exceeds the range of representable sample values.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="stereo-sound-wave-files"></a>Stereo sound, WAVE files<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stereo-sound-wave-files" title="Direct link to heading">#</a></h3><p>Most sound recordings are <em>stereo</em> meaning that there are separate
left and right audio channels.  A common way to represent stereo audio
is to consider the even-numbered samples (0 being the first sample) as
belonging to the left channel, and the odd-numbered samples as belonging
to the right channel.</p><p>The <a href="http://soundfile.sapp.org/doc/WaveFormat/" target="_blank" rel="noopener noreferrer">WAVE file format</a> is a
common file format for digital audio.  Although a variety of encodings
are possible in WAVE files, they are most commonly used for linear PCM
audio data.  Wave files represent stereo PCM data using the scheme just
described (samples 0, 2, 4, etc. belong to the left channel, samples 1,
3, 5, etc. belong to the right channel.)</p><p>In this project you will write programs to read and write audio data in
the WAVE format.  The good news is that WAVE files are pretty simple:
they consist of a <em>header</em> followed by raw sample data.  Digital audio
programs can represent sound waveforms internally using arrays with
sample data.  To read audio data from a WAVE file, a program needs
to read the header, and then read the raw sample data into an array.
To write audio data to a WAVE file, a program needs to write the header,
and then write the raw sample data from an array.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="functional-requirements"></a>Functional requirements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#functional-requirements" title="Direct link to heading">#</a></h1><p>This section documents the functional requirements of the project.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="io-routines"></a>I/O routines<a aria-hidden="true" tabindex="-1" class="hash-link" href="#io-routines" title="Direct link to heading">#</a></h2><p>This section describes the I/O routines that your programs will use to
read binary data and write binary data.  This program module will also
define an error reporting function called <code>fatal_error</code>.  These functions
should be declared in <code>io.h</code> and defined in <code>io.c</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="fatal_error-function"></a><code>fatal_error</code> function<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fatal_error-function" title="Direct link to heading">#</a></h3><p>You can start by implementing (in <code>io.c</code>) the <code>fatal_error</code> function. It
is declared in the <code>io.h</code> header file, as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fatal_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>When this function is called, it should print a line of text to <code>stderr</code> of the form</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error: message text</span></div></div></div></div></div><p>where &quot;message text&quot; is the string passed as the <code>message</code> parameter.</p><p>The purpose of <code>fatal_error</code> is to immediately exit the program if an
unrecoverable error, such as unexpected input data, is encountered.
Although this is a somewhat heavy handed way of dealing with errors, it
is simple.  We will see a more sohisticated and flexible way of reporting
and handling runtime errors later in the course when we cover <em>exceptions</em>
in C++.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="binary-io-routines"></a>Binary I/O routines<a aria-hidden="true" tabindex="-1" class="hash-link" href="#binary-io-routines" title="Direct link to heading">#</a></h3><p>WAVE files are <em>binary</em> files, meaning their contents consist of arbitrary byte values.</p><p>Furthermore, the specific type of WAVE file generated and transformed by
the programs you will implement in this assignment use <em>little-endian</em>
binary data, where multi-byte values are represented as a sequence of
bytes such that less significant bytes occur before more significant
bytes.</p><p>You should start your work by implementing the following binary I/O (input
and output) functions, which are declared in the <code>io.h</code> header file:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_u16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint16_t value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_u32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint32_t value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_s16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int16_t value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_s16_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> int16_t buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_u16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint16_t </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_u32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint32_t </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_s16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int16_t </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_s16_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int16_t buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>write_byte</code>, <code>write_u16</code>, <code>write_u32</code>, and <code>write_s16</code> functions
write a single data value of type <code>char</code>, <code>uint16_t</code>, <code>uint32_t</code>, or
<code>int16_t</code> respectively.</p><p>Multi-byte data values (<code>uint16_t</code>, <code>uint32_t</code>, <code>int16_t</code>) must be written
in <em>little-endian</em> format, such that less significant bytes are written
before more significant bytes.  Because the ugrad machines use x86-64
CPUs, which are little-endian, you may read and write multi-byte data
values by simply treating them as a sequence of bytes.  For example,
to write a <code>uint32_t</code> stored in a variable <code>x</code> to a <code>FILE *</code> file
handle called <code>out</code>, you could use the code</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">fwrite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">uint32_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>write_</code> functions should call <code>fatal_error</code> if an error occurs while writing data.</p><p>The <code>write_bytes</code> and <code>write_s16_buf</code> functions write a sequence of
<code>char</code> or <code>int16_t</code> values, respectively.
The <code>write_bytes</code> function can be implemented by a single call to
<code>fwrite</code>.  The <code>write_s16_buf</code> function can be implemented by calling
<code>write_s16</code> in a loop, once for each element of the argument array.</p><p>The <code>read_byte</code>, <code>read_u16</code>, <code>read_u32</code>, and <code>read_s16</code> functions read a
single data value of type <code>char</code>, <code>uint16_t</code>, <code>uint32_t</code>, or <code>int16_t</code>,
respectively, storing the value read in a variable whose address is
passed as a pointer parameter to the function.
As with the functions to write multi-byte values, the functions which
read multi-byte data values may assume that the little-endian data values
they read can be directly stored in memory, because we will be running
on a little endian CPU.  For example, if you need to read a 32 bit
unsigned value into a <code>uint32_t</code> variable <code>x</code> from a <code>FILE *</code> file
handle called <code>in</code>, you could use the code</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">fread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">uint32_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>read_bytes</code> and <code>read_s16_buf</code> functions read a sequence of <code>char</code>
or <code>int16_t</code> values, respectively, and store them in the array passed
as a parameter.  <code>read_bytes</code> can be implemented by a single call to
<code>fread</code>.  <code>read_s16_buf</code> can be implemented by calling <code>read_s16</code> in a
loop, once per element.</p><p>If any of the <code>read_</code>  functions fail to read the required number of
data bytes, they should call the <code>fatal_error</code> function.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="wave-routines"></a>Wave routines<a aria-hidden="true" tabindex="-1" class="hash-link" href="#wave-routines" title="Direct link to heading">#</a></h2><p>This section describes functions for working with WAVE files and digital
audio waveforms.  This module of the program consists of the header file
<code>wave.h</code> and the source file <code>wave.c</code>.</p><p>The <code>write_wave_header</code> and <code>read_wave_header</code> functions require the
<a href="#">binary I/O functions</a>, so implement those first.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="waveh"></a><code>wave.h</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#waveh" title="Direct link to heading">#</a></h3><p>The header file <code>wave.h</code>, as distributed in the public repo, has the following contents:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdint.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> PI                 3.14159265358979323846</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SAMPLES_PER_SECOND 44100u</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> NUM_CHANNELS       2u</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> BITS_PER_SAMPLE    16u</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* waveforms */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SINE          0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SQUARE        1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SAW           2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> NUM_WAVEFORMS 3 </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* one greater than maximum legal voice */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* timing characteristics for ADSR envelope */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> ATTACK_NUM_SAMPLES  441</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> DECAY_NUM_SAMPLES   441</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> RELEASE_NUM_SAMPLES 441</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Functions for writing and reading a WAVE header.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_wave_header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_wave_header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Compute appropriate gains for a stereo pan at given angle in radians.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Left and right channel gains are stored in the channel_gain array.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">compute_pan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> angle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> channel_gain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Basic full-amplitude wave generation into a mono sample buffer</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_sine_wave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> freq_hz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_square_wave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> freq_hz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_saw_wave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> freq_hz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Scale each sample in a mono sample buffer by specified factor</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apply_gain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> gain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Apply an ADSR envelope to a mono sample buffer. This should only</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// be done *after* attenuating the contents of the buffer to a reasonable</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// level, since the peak of the attack will actually increase the</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// signal&#x27;s amplitude.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apply_adsr_envelope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Mix a mono sample buffer into a stereo stream.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// channel should be 0 (left) or 1 (right).</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// stereo_buf should be pointing to a left-channel sample.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mix_in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t stereo_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The constants <code>SAMPLES_PER_SECOND</code>, <code>NUM_CHANNELS</code>, and <code>BITS_PER_SAMPLE</code> define the parameters of stereo CD-quality PCM audio.</p><p>The constant <code>PI</code> closely approximates the value of Ï€.</p><p>The constants <code>SINE</code>, <code>SQUARE</code>, and <code>SAW</code> distinguish the three kinds of audio waveforms that the <code>render_song</code> program can generate.</p><p>The function declarations are for functions defined in <code>wave.c</code>: these are described in more detail below.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="read_wave_header-write_wave_header"></a><code>read_wave_header</code>, <code>write_wave_header</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#read_wave_header-write_wave_header" title="Direct link to heading">#</a></h3><p>Two functions called <code>read_wave_header</code> and <code>write_wave_header</code> are provided (including implementations in <code>wave.c</code>) which, respectively, read the header information from a WAVE file, and write header information for a WAVE file.  WAVE files are essentially just header information followed by a sequence of sample values.</p><p>You can look at the implementation of <code>read_wave_header</code> and <code>write_wave_header</code> to see how they use your binary I/O functions.  Note that both routines are hard-coded to support only 16 bits per sample, 44.1 KHz, stereo (two channel) WAVE files.  For our purposes, the only &quot;interesting&quot; value in the WAVE header is the number of <em>stereo</em> samples, which determines the length of the audio.  Note that a stereo sample consists of <em>two</em> 16-bit signed integer values, one for each channel (left and right).</p><p>Here is a very simple example program that calls <code>read_wave_header</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdio.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdlib.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;io.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;wave.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">fprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">stderr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Usage: %s &lt;wave file&gt;\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fopen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rb&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">in </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">fatal_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Couldn&#x27;t open wave file&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">read_wave_header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Wave file has %u stereo samples\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">fclose</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>Let&#x27;s say that we compile and link this program as an executable called <code>readwav</code>.  If we run the program on the WAVE file called <a href="/cs220-sp21/docs/assignments/snd/a440.wav">a440.wav</a> as follows</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./readwav a440.wav</span></div></div></div></div></div><p>The output will be</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Wave file has 44100 stereo samples</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rendering-tones"></a>Rendering tones<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rendering-tones" title="Direct link to heading">#</a></h3><p>The <code>generate_sine_wave</code>, <code>generate_square_wave</code>, and <code>generate_saw_wave</code> functions, as declared in the initial version of <code>wave.h</code>, are intended to generate full-amplitude sine, square, and sawtooth waveforms with a specified frequency in a specified (mono) sample buffer.</p><p>A square wave is a waveform where the generated sample values oscillate between maximum and minimum sample values (with respect to the amplitude), i.e.</p><p><img alt="Square wave" src="/cs220-sp21/assets/images/sound-square-7cdd1f0f52c1b76a5c3d5750fc41784c.png"></p><p>Square waves are easy to generate using digital electronics, and were used frequently in early home computers and video games.  Here is a 440 Hz square wave:</p><audio controls=""><source src="../../snd/a440_sq.wav" type="audio/wav"></audio><p>A sawtooth wave rises steadily from the minimum sample value to the maximum sample value (with respect to amplitude) on each cycle, i.e.</p><p><img alt="Sawtooth wave" src="/cs220-sp21/assets/images/sound-saw-7fe832f1b48f8ea0e78fc130aca71dc4.png"></p><p>Sawtooth waves have a more &quot;horn-like&quot; sound than a plain sine wave.  Here is a 440 Hz sawtooth wave:</p><audio controls=""><source src="../../snd/a440_saw.wav" type="audio/wav"></audio><p>The <code>apply_gain</code> function modifies the samples in a mono sample buffer
by scaling them by a specified gain factor. This function is useful for
reducing the amplitude of a full-amplitude waveform.</p><p>The <code>apply_adsr_envelope</code> function applies and ADSR (attack, sustain,
decay, release) envelope to the waveform in a mono sample buffer.
<em>FIXME</em>: explain what this means.</p><p>The <code>mix_in</code> function takes a rendered mono waveform and mixes it into one channel
of a stereo sample buffer.  Channel 0 is the left channel, and channel 1 is the right
channel.  This function should ensure that sample values stay in the range
-32,768 to 32,767, clamping them at these minimum and maximum values if necessary.</p><p>The <code>compute_pan</code> function computes appropriate gain factors for the
left and right channels, according to a <em>pan angle</em> specified in radians.
This function should use the following gain formulas, where <em>Î¸</em> is the
pan angle, and <em>L</em> and <em>R</em> are the computed left and right channel gain factors:</p><p><em>L</em> = âˆš2/2 Ã— (cos Î¸ + sin Î¸)</p><p><em>R</em> = âˆš2/2 Ã— (cos Î¸ - sin Î¸)</p><p>The <code>render_song</code> program will allow instrument sounds to be panned, so
being able to compute appropriate channel gain factors will be important
for that program.</p><p><strong>Important</strong>: Note that you do not need to implement any of the
<code>render_</code> functions exactly as described above.  You will need to
implement functions to generate tones, but you are free to implement
them in whatever way you think is appropriate.  Having said that,
the functions described above, if you implement them, will allow
you to complete the required programs in a fairly straightforward way.</p><p><strong>Recommendation</strong>: Don&#x27;t implement all of the audio generation functions
at once.  Implement them as needed to support the three programs you
will be implementing, <code>render_tone</code>, <code>render_song</code>, and <code>render_echo</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="hints-on-how-to-render-waveforms"></a>Hints on how to render waveforms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#hints-on-how-to-render-waveforms" title="Direct link to heading">#</a></h3><p>Rendering sine waves is relatively straightforward, since you can use the equation</p><p><em>p</em> = <em>a</em> Ã— sin(<em>tf</em> Ã— 2Ï€)</p><p>more or less directly.  The main thing you&#x27;ll need to think about is how
to convert a sample number into a time value <em>t</em>.  (Hint: the number of
samples in one second of audio is defined by the <code>SAMPLES_PER_SECOND</code>
constant.)  Also, because <em>p</em> will range from -1.0 to 1.0, you&#x27;ll need
to scale it appropriately to fit the range of the <code>int16_t</code> data type.</p><p>You can think of square waves as being modified sine waves:</p><ul><li>For any sample where a sine wave would have a non-negative value,
the square wave should have a &quot;maximum&quot; value (with respect to amplitude)</li><li>For any sample where a sine wave would have a negative value, the
square wave should have a &quot;minimum&quot; value (with respect to amplitude)</li></ul><p>However you generate square waves, make sure that the duty cycle is 50%,
meaning that the runs of maximum sample values are about the same length
as the runs of minimum sample values.</p><p>The sample values generated for sawtooth waves should increase linearly
from the minimum to maximum throughout each cycle.  One way to implement
this is to take the time <em>t</em> of the sample, and divide it by the length
of one cycle.  For example, let&#x27;s say the frequency is 440 Hz, which
would make the cycle length 1/440 seconds.  If <em>t</em> is 4.9902 seconds,
then dividing <em>t</em> by the cycle length gives us approximately 2195.688000.
Subtracting the <em>floor</em> of this value gives us 0.688.  What this means
is that for our value of <em>t</em> (4.9902 seconds), the generated sawtooth
waveform about 2/3 of the way through the current cycle (0.688 is
about 2/3.)  Knowing where <em>t</em> is within the current cycle allows us to
compute an appropriate sample value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rendering-is-additive"></a>Rendering is additive!<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rendering-is-additive" title="Direct link to heading">#</a></h3><p><strong>Extremely important consideration</strong>: Your tone-rendering functions
should be <code>additive</code>, meaning that the waveforms that are rendered should
be <em>added</em> to whatever sample values are already present.  This is
necessary, for example, to allow the <code>render_song</code>
program to produce chords, where several frequencies are generated at
the same time.</p><p>There are a couple of things you should think about in order to make this work correctly:</p><ol><li>You will want all sample values to be initialized to zero, prior
to any of the <code>render_</code> functions being called.  This ensures that the
`initial signal is silence.</li><li>If the result of adding a new sample value to an existing sample
value is either greater than 32,767 or less than -32,768 (these are
the maximum and minimum <code>int16_t</code> values, respectively), then your code
should clamp the result at 32,767 or -32,768.  (See the <a href="#sound">Sound</a>
section for details.)  To detect when a computed sample value is outside
the legal range, your code will need to do the addition using a data
type with a larger range of possible values (e.g., <code>int32_t</code>.)</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-render_tone-program"></a>The <code>render_tone</code> program<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-render_tone-program" title="Direct link to heading">#</a></h2><p>The <code>render_tone</code> program renders a continuous tone with a specified
voice, frequency, amplitude, and duration.  This document describes the
requirements for the <code>render_tone</code> program.  This program will be a good
way for you to validate the implementations of the <a href="#wave-routines">wave routines</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="invocation-of-render_tone"></a>Invocation of <code>render_tone</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#invocation-of-render_tone" title="Direct link to heading">#</a></h3><p>The program is invoked as</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone voice frequency amplitude numsamples wavfileout</span></div></div></div></div></div><p>The <code>voice</code> argument is an integer specifying the waveform shape to
generate: 0 for sine wave, 1 for square wave, 2 for sawtooth wave.
(See the <a href="#wave-routines">WAVE routines</a> section for information about how
to generate sine, square, and sawtooth waves.)</p><p>The <code>frequency</code> argument is a floating-point value
specifying the frequency of the tone in Hz (cycles per second.)</p><p>The <code>amplitude</code> argument is a floating-point value
specifying the relative amplitude of the tone, with 0.0 being complete
silence, to 1.0 being maximum volume.</p><p>The <code>numsamples</code> argument is the number of stereo samples
to generate.  Because the sampling frequency is fixed at 44.1 KHz,
there are 44,100 stereo samples per second.  (Remember that a stereo
sample consists of two signed 16-bit values, one for each audio channel.)</p><p>The <code>wavfileout</code> argument specifies the name of the output
WAVE file to generate.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_tone-examples"></a><code>render_tone</code> examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_tone-examples" title="Direct link to heading">#</a></h3><p>Here are some examples of invoking the <code>render_tone</code> program and what
the resulting wave file should sound like.</p><p>Rendering a 130.81 Hz sine wave:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">130.81</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">44100</span><span class="token plain"> c131_sine.wav</span></div></div></div></div></div><p>Resulting audio:</p><audio controls=""><source src="../../snd/c131_sine.wav" type="audio/wav"></audio><p>Rendering a 130.81 Hz square wave:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">130.81</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">44100</span><span class="token plain"> c131_sq.wav</span></div></div></div></div></div><p>Resulting audio:</p><audio controls=""><source src="../../snd/c131_sq.wav" type="audio/wav"></audio><p>Rendering a 130.81 Hz sawtooth wave:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">130.81</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">44100</span><span class="token plain"> c131_saw.wav</span></div></div></div></div></div><p>Resulting audio:</p><audio controls=""><source src="../../snd/c131_saw.wav" type="audio/wav"></audio><div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_tone-approach"></a><code>render_tone</code> approach<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_tone-approach" title="Direct link to heading">#</a></h3><p>First, the program should allocate an appropriately-sized mono sample buffer,
and call either <code>generate_sine_wave</code>, <code>generate_square_wave</code>, or
<code>generate_saw_wave</code> to generate an appropriate waveform.  It should also
call the <code>apply_gain</code> function so that the waveform has the specified
amplitude.</p><p>Next, the program should create a stereo sample array of an appropriate length
(make sure the sample values are initially zero!), and call <code>mix_in</code> to
incorporate the waveform into both the left and right channels.</p><p>Finally, the program should open the output file, call the <code>write_wave_header</code>
function to write the WAVE header, then write the stereo sample data.</p><p>Make sure that the program frees all allocated memory and closes any file
that was opened.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-render_song-program"></a>The <code>render_song</code> program<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-render_song-program" title="Direct link to heading">#</a></h2><p>This document describes the <code>render_song</code> program.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="invocation-input-data-format"></a>Invocation, input data format<a aria-hidden="true" tabindex="-1" class="hash-link" href="#invocation-input-data-format" title="Direct link to heading">#</a></h3><p>The <code>render_song</code> program, whose <code>main</code> function should be defined in
<code>render_song.c</code>, is invoked as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_song songinput waveoutput</span></div></div></div></div></div><p>The file <code>songinput</code> is a text file describing a &quot;song&quot;.
The first value in a song file is the total number of samples.
For example, if this value is</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">352800</span></div></div></div></div></div><p>then the song is 352,800 samples long.  With the fixed 44.1 KHz sample rate,
this means that the song is exactly 8 seconds long, and that one beat is exactly 0.5 seconds.</p><p>Next, the song file will have a series of <em>directives</em>.  The following directives
should be supported:</p><ul><li><code>N instrument start end note gain</code>: render a note using specified
instrument, starting at sample number <code>start</code>, ending just before sample
<code>end</code>, playing MIDI note number <code>note</code>, with specified <code>gain</code> factor</li><li><code>W instrument waveform</code>: set the waveform of specified instrument, 0 for
sine, 1 for square, 2 for sawtooth</li><li><code>P instrument angle</code>: set the stereo pan angle (in radians) of specified instrument</li><li><code>E instrument enable</code>: enable or disable ADSR envelope on specified instrument
(0 to disable, 1 to enable)</li><li><code>G instrument gain</code>: set the gain factor (0.0 to 1.0) of specified instrument</li></ul><p>There are 16 instruments, numbered 0 through 15.  By default each instrument:</p><ul><li>Uses the sine waveform</li><li>Has its pan angle set to 0.0 (centered)</li><li>Has the ADSR envelope disabled</li><li>Has its gain set to 0.2</li></ul><p>The <code>W</code>, <code>P</code>, <code>E</code>, and <code>G</code> directives modify the characteristics of a specified instrument.</p><p>A <a href="https://newt.phys.unsw.edu.au/jw/notes.html" target="_blank" rel="noopener noreferrer">MIDI note number</a> <em>n</em> can be converted to a frequency <em>f</em> using the following formula:</p><p><em>f</em> = 440 Ã— 2<sup>(<i>n</i>-69) / 12</sup></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_song-example"></a><code>render_song</code> example<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_song-example" title="Direct link to heading">#</a></h3><p>Here is a fairly simple song:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">352800</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">W 0 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">E 0 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">P 0 -0.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">W 1 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">E 1 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">P 1 0.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 0 8820 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 0 8820 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 22050 30870 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 22050 30870 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 44100 52920 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 44100 52920 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 66150 74970 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 66150 74970 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 88200 97020 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 88200 97020 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 110250 119070 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 110250 119070 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 132300 141120 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 132300 141120 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 154350 163170 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 154350 163170 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 176400 194040 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 176400 194040 70 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 220500 238140 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 220500 238140 70 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 264600 282240 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 264600 282240 70 0.8</span></div></div></div></div></div><p>Note that there are two instruments, 0 and 1.  ADSR envelopes are enabled for
both instruments.  Instrument 0 plays notes using a square wave, and is panned
at angle -0.4.  Instrument 1 plays notes using a sawtooth wave, and is panned
at angle 0.4.  If we save this song in a file called <code>example.txt</code>, we can
render it as a wave file using the command</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_song example.txt example.wav</span></div></div></div></div></div><p>The result sounds like this:</p><audio controls=""><source src="../../snd/example.wav" type="audio/wav"></audio><p><em>TODO</em> examples of more interesting songs</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="important-requirement"></a>Important requirement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#important-requirement" title="Direct link to heading">#</a></h3><p>It is a requirement for this program that you use a <code>struct</code> data type to
represent the information about each instrument.  Here is a possible
definition:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Instrument</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> waveform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bool use_adsr_envelope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> pan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> gain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>By declaring an array of elements of this type:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Instrument</span><span class="token plain"> instruments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>you can represent all of the required information about each of the 16
possible instruments.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_song-approach"></a><code>render_song</code> approach<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_song-approach" title="Direct link to heading">#</a></h3><p>The program should open the input text file and read the duration from it.
It can use the duration to create a stereo sample array of an appropriate
length.</p><p>The program&#x27;s main loop should read directives one at a time and process them.</p><p><code>N</code>  directives can be carried out by calling <code>generate_sine_wave</code>,
<code>generate_square_wave</code>, or <code>generate_saw_wave</code> to render the note into
a mono sample buffer, calling <code>apply_gain</code> to scale the samples according
to the instrument and note gain values, calling <code>apply_adsr_envelope</code>
if appropriate (depending on whether it is enabled for the instrument
being played), calling <code>compute_pan</code> to compute the appopriate channel
gain values according to the instruments pan angle, then incorporating
the mono sample values into each channel with the correct sample gain.
(If you use the <code>mix_in</code> function to do this, you will probably need
to allocate a separate mono sample buffer to hold the samples scaled
correctly for the output channel.)</p><p><code>W</code>, <code>P</code>, <code>E</code>, and <code>G</code> directives should modified the appropriate instance
of the struct type representing instruments.</p><p>If, when attempting to read a directive character, the program encounters
end of file, that means that the song has ended.</p><p>If the input is malformed, the program should call the <code>fatal_error</code> function.</p><p>Make sure that all memory is freed and file(s) closed before the program exits.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-render_echo-program"></a>The <code>render_echo</code> program<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-render_echo-program" title="Direct link to heading">#</a></h2><p>This section describes the requirements for the <code>render_echo</code> program.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="invocation"></a>Invocation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#invocation" title="Direct link to heading">#</a></h3><p>The <code>render_echo</code> program processes an input WAVE file to generate an echo effect, and is invoked as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo wavfilein wavfileout delay amplitude</span></div></div></div></div></div><p>The <code>wavfilein</code> argument names an input WAVE file.</p><p>The <code>wavfileout</code> argument names an output WAVE file to write,
which will be a transformed version of <code>wavfilein</code>.</p><p>The <code>delay</code> argument is an integer delay, specified as a number of samples.</p><p>The <code>amplitude</code> argument is a floating point value in the range 0.0 to 1.0,
specifying a relative amplitude of the echo effect to generate.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="generating-an-echo"></a>Generating an echo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#generating-an-echo" title="Direct link to heading">#</a></h3><p>Generating an echo is simple: the program should add an attenuated copy of
the audio signal at an offset as indicated by the <code>delay</code>
argument.  For example, if <code>delay</code> is 22050, that
indicates a delay of 0.5 seconds.  The amplitude of the copied signal
is specified by the <code>amplitude</code> argument.  For example,
if <code>amplitude</code> is 0.4, then the echoed copy of the signal
should be 40% of the amplitude of the original.</p><p>Note that the output will need to be <code>delay</code> number of samples longer than
the input, in order to ensure that echoes of samples at the end of the original
file are rendered.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="examples"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples" title="Direct link to heading">#</a></h3><p>As an example, let&#x27;s say that <code>example.wav</code> is the original version of the
example song described in <a href="#the-render_song-program">the render_song program</a>, and we run the command</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo example.wav example_echo.wav 11025 0.4</span></div></div></div></div></div><p>Recall that the original sounded like this:</p><audio controls=""><source src="../../snd/example.wav" type="audio/wav"></audio><p>The result is this:</p><audio controls=""><source src="../../snd/example_echo.wav" type="audio/wav"></audio><p>The following (famous!) audio clip was used to test sound support early
in the development of the Linux operating system:</p><audio controls=""><source src="../../snd/linux.wav" type="audio/wav"></audio><p>Assuming that this file is called <code>linux.wav</code>, we could add an echo with a 0.5
second delay with the command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo linux.wav linux_echo.wav 22050 0.4</span></div></div></div></div></div><p>This yields the following result:</p><audio controls=""><source src="../../snd/linux_echo.wav" type="audio/wav"></audio><p>We can add an additional echo with a 0.25 second delay with the command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo linux_echo.wav linux_echo2.wav 11025 0.4</span></div></div></div></div></div><p>The result of this second command is the following:</p><audio controls=""><source src="../../snd/linux_echo2.wav" type="audio/wav"></audio><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_echo-approach"></a><code>render_echo</code> approach<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_echo-approach" title="Direct link to heading">#</a></h3><p>Your program will need to open the input file, call <code>read_wave_header</code>
to read the WAVE header and get the number of (stereo) samples, then read
the sample data into an array.  Adding the echo effect can be accomplished
by adding attenuated sample values to the sample value at a later audio
position, effectively mixing the echo into the original audio.  Note that
you need to be careful about the order in which you process the samples!</p><p>Once the sample data has been updated, open the output file, call
<code>write_wave_header</code> to write the WAVE header, then write the updated
sample values.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="testing"></a>Testing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>TODO: suggestions for testing</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="tips"></a>Tips<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tips" title="Direct link to heading">#</a></h2><p>TODO: tips and recommendations</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="packaging-requirements"></a>Packaging requirements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#packaging-requirements" title="Direct link to heading">#</a></h2><p>TODO: how the makefile will need to work</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started" class="table-of-contents__link">Getting started</a></li><li><a href="#what-sound-is" class="table-of-contents__link">What sound is</a><ul><li><a href="#complex-audio-waveforms" class="table-of-contents__link">Complex audio waveforms</a></li><li><a href="#digital-sound" class="table-of-contents__link">Digital sound</a></li><li><a href="#mixing-digital-audio-signals-clipping" class="table-of-contents__link">Mixing digital audio signals, clipping</a></li><li><a href="#stereo-sound-wave-files" class="table-of-contents__link">Stereo sound, WAVE files</a></li></ul></li><li><a href="#io-routines" class="table-of-contents__link">I/O routines</a><ul><li><a href="#fatal_error-function" class="table-of-contents__link"><code>fatal_error</code> function</a></li><li><a href="#binary-io-routines" class="table-of-contents__link">Binary I/O routines</a></li></ul></li><li><a href="#wave-routines" class="table-of-contents__link">Wave routines</a><ul><li><a href="#waveh" class="table-of-contents__link"><code>wave.h</code></a></li><li><a href="#read_wave_header-write_wave_header" class="table-of-contents__link"><code>read_wave_header</code>, <code>write_wave_header</code></a></li><li><a href="#rendering-tones" class="table-of-contents__link">Rendering tones</a></li><li><a href="#hints-on-how-to-render-waveforms" class="table-of-contents__link">Hints on how to render waveforms</a></li><li><a href="#rendering-is-additive" class="table-of-contents__link">Rendering is additive!</a></li></ul></li><li><a href="#the-render_tone-program" class="table-of-contents__link">The <code>render_tone</code> program</a><ul><li><a href="#invocation-of-render_tone" class="table-of-contents__link">Invocation of <code>render_tone</code></a></li><li><a href="#render_tone-examples" class="table-of-contents__link"><code>render_tone</code> examples</a></li><li><a href="#render_tone-approach" class="table-of-contents__link"><code>render_tone</code> approach</a></li></ul></li><li><a href="#the-render_song-program" class="table-of-contents__link">The <code>render_song</code> program</a><ul><li><a href="#invocation-input-data-format" class="table-of-contents__link">Invocation, input data format</a></li><li><a href="#render_song-example" class="table-of-contents__link"><code>render_song</code> example</a></li><li><a href="#important-requirement" class="table-of-contents__link">Important requirement</a></li><li><a href="#render_song-approach" class="table-of-contents__link"><code>render_song</code> approach</a></li></ul></li><li><a href="#the-render_echo-program" class="table-of-contents__link">The <code>render_echo</code> program</a><ul><li><a href="#invocation" class="table-of-contents__link">Invocation</a></li><li><a href="#generating-an-echo" class="table-of-contents__link">Generating an echo</a></li><li><a href="#examples" class="table-of-contents__link">Examples</a></li><li><a href="#render_echo-approach" class="table-of-contents__link"><code>render_echo</code> approach</a></li></ul></li><li><a href="#testing" class="table-of-contents__link">Testing</a></li><li><a href="#tips" class="table-of-contents__link">Tips</a></li><li><a href="#packaging-requirements" class="table-of-contents__link">Packaging requirements</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 CS220, Johns Hopkins University, Built with Docusaurus.</div></div></div></footer></div>
<script src="/cs220-sp21/styles.a74149fa.js"></script>
<script src="/cs220-sp21/runtime~main.6fca5550.js"></script>
<script src="/cs220-sp21/main.30419887.js"></script>
<script src="/cs220-sp21/1.c4127283.js"></script>
<script src="/cs220-sp21/2.4f001a13.js"></script>
<script src="/cs220-sp21/54.75b9ba21.js"></script>
<script src="/cs220-sp21/55.349af7d3.js"></script>
<script src="/cs220-sp21/f976f453.8850f580.js"></script>
<script src="/cs220-sp21/17896441.2b62ceab.js"></script>
<script src="/cs220-sp21/5da55f63.5b2c6c92.js"></script>
</body>
</html>