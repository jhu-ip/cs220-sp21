<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous"><title data-react-helmet="true">Midterm Project | EN.601.220: Intermediate Programming</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Midterm Project | EN.601.220: Intermediate Programming"><meta data-react-helmet="true" name="description" content="* You are expected to work as a team of two."><meta data-react-helmet="true" property="og:description" content="* You are expected to work as a team of two."><meta data-react-helmet="true" property="og:url" content="https://jhu-ip.github.io/cs220-sp21/docs/assignments/midterm"><link data-react-helmet="true" rel="shortcut icon" href="/cs220-sp21/img/logo_cpp.svg"><link data-react-helmet="true" rel="canonical" href="https://jhu-ip.github.io/cs220-sp21/docs/assignments/midterm"><link rel="stylesheet" href="/cs220-sp21/styles.941952b5.css">
<link rel="preload" href="/cs220-sp21/styles.d0d6582a.js" as="script">
<link rel="preload" href="/cs220-sp21/runtime~main.e22df359.js" as="script">
<link rel="preload" href="/cs220-sp21/main.6e648f78.js" as="script">
<link rel="preload" href="/cs220-sp21/1.acaf7783.js" as="script">
<link rel="preload" href="/cs220-sp21/2.1630dbbf.js" as="script">
<link rel="preload" href="/cs220-sp21/76.315a6249.js" as="script">
<link rel="preload" href="/cs220-sp21/77.29bcc7d1.js" as="script">
<link rel="preload" href="/cs220-sp21/935f2afb.2b8d7949.js" as="script">
<link rel="preload" href="/cs220-sp21/17896441.62b1b4c6.js" as="script">
<link rel="preload" href="/cs220-sp21/99dc33a9.e1b3604d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top navbarHideable_3046"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/cs220-sp21/"><img class="navbar__logo" src="/cs220-sp21/img/logo_cpp.svg" alt="CS220"><strong class="navbar__title">CS220</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cs220-sp21/docs">Syllabus</a><a class="navbar__item navbar__link" href="/cs220-sp21/staff/">Course Staff</a><a href="https://docs.google.com/spreadsheets/d/1OCSl2UKclPT7asoEoSwNgRdAoJnRbQPbonDbS89JV7Q/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">CA Office Hours</a><a class="navbar__item navbar__link" href="/cs220-sp21/materials/">Course Material</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a href="#" class="navbar__item navbar__link">Assignments</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cs220-sp21/docs/assignments/hw0">Homework 0</a></li><li><a class="dropdown__link" href="/cs220-sp21/docs/assignments/hw1">Homework 1</a></li><li><a href="https://www.gradescope.com/courses/230194/assignments/1006756" target="_blank" rel="noopener noreferrer" class="dropdown__link">Homework 2</a></li><li><a class="dropdown__link" href="/cs220-sp21/docs/assignments/hw3">Homework 3</a></li><li><a href="https://www.gradescope.com/courses/230194/assignments/1029598" target="_blank" rel="noopener noreferrer" class="dropdown__link">Homework 4</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/cs220-sp21/docs/assignments/midterm">Midterm project</a></li><li><a class="dropdown__link" href="/cs220-sp21/docs/assignments/hw5">Homework 5</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a href="#" class="navbar__item navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/cs220-sp21/docs/resources/github-ssh">Github ssh authentication</a></li><li><a href="https://docs.google.com/document/d/19Wwak8BQWpML5ot-u3NRs38EtpuA-I5g5ACQbbDzg5U/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="dropdown__link">Midterm Review Questions</a></li><li><a href="https://docs.google.com/document/d/1f_Tp9_IKy-kdCfzrnTLuZPpsXpL0Z7YobYPnBz1T5A8/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="dropdown__link">Midterm Review Answers</a></li><li><a href="https://docs.google.com/presentation/d/1SBNONdfctV4xZtavyIF4luisiaiqV9MmhEYI-i4wAcc/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="dropdown__link">Midterm Review Slides</a></li><li><a href="https://jh.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=ddfbb1ab-f575-4eb2-b1f7-ace40161a42c" target="_blank" rel="noopener noreferrer" class="dropdown__link">Midterm Review Session</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/cs220-sp21/"><img class="navbar__logo" src="/cs220-sp21/img/logo_cpp.svg" alt="CS220"><strong class="navbar__title">CS220</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/cs220-sp21/docs">Syllabus</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/staff/">Course Staff</a></li><li class="menu__list-item"><a href="https://docs.google.com/spreadsheets/d/1OCSl2UKclPT7asoEoSwNgRdAoJnRbQPbonDbS89JV7Q/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="menu__link">CA Office Hours</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/materials/">Course Material</a></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist">Assignments</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/assignments/hw0">Homework 0</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/assignments/hw1">Homework 1</a></li><li class="menu__list-item"><a href="https://www.gradescope.com/courses/230194/assignments/1006756" target="_blank" rel="noopener noreferrer" class="menu__link">Homework 2</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/assignments/hw3">Homework 3</a></li><li class="menu__list-item"><a href="https://www.gradescope.com/courses/230194/assignments/1029598" target="_blank" rel="noopener noreferrer" class="menu__link">Homework 4</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/cs220-sp21/docs/assignments/midterm">Midterm project</a></li><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/assignments/hw5">Homework 5</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a href="#" role="button" class="menu__link menu__link--sublist">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/cs220-sp21/docs/resources/github-ssh">Github ssh authentication</a></li><li class="menu__list-item"><a href="https://docs.google.com/document/d/19Wwak8BQWpML5ot-u3NRs38EtpuA-I5g5ACQbbDzg5U/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="menu__link">Midterm Review Questions</a></li><li class="menu__list-item"><a href="https://docs.google.com/document/d/1f_Tp9_IKy-kdCfzrnTLuZPpsXpL0Z7YobYPnBz1T5A8/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="menu__link">Midterm Review Answers</a></li><li class="menu__list-item"><a href="https://docs.google.com/presentation/d/1SBNONdfctV4xZtavyIF4luisiaiqV9MmhEYI-i4wAcc/edit?usp=sharing" target="_blank" rel="noopener noreferrer" class="menu__link">Midterm Review Slides</a></li><li class="menu__list-item"><a href="https://jh.hosted.panopto.com/Panopto/Pages/Viewer.aspx?id=ddfbb1ab-f575-4eb2-b1f7-ace40161a42c" target="_blank" rel="noopener noreferrer" class="menu__link">Midterm Review Session</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Midterm Project</h1></header><div class="markdown"><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><ul><li>You are expected to work as a team of two.</li><li><strong>Due: Thursday <strong>March 25th</strong> at 11pm EDT (Baltimore time).</strong></li><li>No late days are allowed!</li></ul></div></div><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="introduction"></a>Introduction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#introduction" title="Direct link to heading">#</a></h1><p>In this project you will implement helper functions and programs to
generate and transform digital audio.</p><p>This is a paired project, so you will work with one classmate.  You should
practice pair programming where you work synchronously with your partner, in
driver/navigator roles, to design and implement the program.  We will spend some time in
class working on the project, so your partner needs to be in your section. [Students who cannot attend class synchronously should find a partner in the same time zone.]</p><p>You will use git for version control. You should have registered your team <a href="https://piazza.com/class/kjipwszll9atf?cid=436" target="_blank" rel="noopener noreferrer">here</a> by <em>Thursday March 4th at noon</em>. Otherwise, we will pair you up with a classmate. A private repo repo named something like <code>2021-spring-midterm-&lt;JHED1&gt;-&lt;JHED2&gt;</code> will be created for your team. You should use this repo for your midterm project development.</p><p>The project is larger and more complex than the previous homework
assignments. Youâ€™ll want to start early and make steady, incremental
progress towards completing the project requirements.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="getting-started"></a>Getting started<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="set-up-your-midterm-project-git-repository"></a>Set up your midterm project git repository<a aria-hidden="true" tabindex="-1" class="hash-link" href="#set-up-your-midterm-project-git-repository" title="Direct link to heading">#</a></h3><ul><li><p>If you have registered your team on time, you will see the private repo (<code>2021-spring-midterm-&lt;JHED1&gt;-&lt;JHED2&gt;</code>) under your repositories on GitHub.  </p></li><li><p>Otherwise, you should receive a private post from us about your assigned partner on Piazza. You should reply to the post to exchange your contact information with your teammate and let us know all members are connected. We will assign you the project repo. If you have not received the post, reach out to us as soon as possible.</p></li></ul><p>Once you have access to <code>2021-spring-midterm-&lt;JHED1&gt;-&lt;JHED2&gt;</code>, you should clone the repo to your ugrad unix account (and optionally local machine) the same way you cloned your personal repo in <a href="/cs220-sp21/docs/exercises/ex1-3#part-2">Ex1-3 Part 2</a>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>If you have opted to use <a href="/cs220-sp21/docs/resources/github-ssh">SSH authentication</a>, remember to clone it with the <code>git@</code> link. Otherwise, you should use the <code>https://</code> one.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="get-the-starter-codes-from-the-public-repository"></a>Get the starter codes from the public repository<a aria-hidden="true" tabindex="-1" class="hash-link" href="#get-the-starter-codes-from-the-public-repository" title="Direct link to heading">#</a></h3><ol><li><p>Use <code>cd</code> to move into the public repo folder on your unix account (e.g. <code>~/cs220-sp21-public</code>), type <code>git status</code> and confirm you have not modified any files or accidentally committed to the public repo. Ask for help if you need to undo those accidental changes.</p></li><li><p>Type <code>git pull</code> to synchronize your local repo with the remote repo.</p></li><li><p>You should see a new folder <code>midterm</code>, which contains the starter code. There will be four C source files: <code>io.h</code>, <code>io.c</code>, <code>wave.h</code>, and <code>wave.c</code>.  There will also be several text files (ending in the <code>.txt</code> file extension) as well as several audio files (ending in <code>.wav</code> and <code>.mp3</code> file extensions.)</p></li><li><p>Copy the source files and <code>.txt</code> files in <code>midterm</code> to your midterm project repo. Assuming both the public repo and your midterm repo are under your home directory, and you have not changed the folder names, then you can run <code>cp ~/cs220-sp21-public/midterm/*.{c,h,txt} ~/2021-spring-midterm-&lt;JHED1&gt;-&lt;JHED2&gt;/</code> to copy the starter codes to your local midterm repo.  (You may eventually want to copy the audio files, but you don&#x27;t need to do that right away.)</p></li><li><p>Use <code>cd</code> to move into your midterm repo (e.g. <code>~/2021-spring-midterm-&lt;JHED1&gt;-&lt;JHED2&gt;</code>), type <code>git status</code> and confirm you see all the starter files.</p></li><li><p>Do your first commit to add the starter codes to the repo and push them to the remote repo. You can run <code>git add .</code>, <code>git commit -m &quot;Initialized with the starter codes&quot;</code>, and <code>git push</code>.</p></li></ol><p>Your midterm repo is now ready for development!</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Only one of the team members needs to set up the repo when it is the first use. Once it has been set up, the partner can get the starter codes directly by cloning the remote repo or synchronizing their local repos (<code>pull</code>). </p><p>You now work in a team. You may encounter <strong>conflicts</strong> more often when you push your code from local to remote. This happens when your teammates have changed the same files and same segments as you have done. If it happens, you will need to resolve the conflicts, compile and test your codes before committing the conflict-resolved version. Typically you will see something like below in the file that has a conflict:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">This is how the file in the current remote (github) repo looks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">=======</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">This is how the file in your local repo looks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;a commit id&gt;</span></div></div></div></div></div><p>To resolve the conflict, you need to decide which version to use or how they should be merged. To minimize the conflicts, you should</p><ul><li>Communicate with your teammates to avoid editing a file at the same time,</li><li>Always sync with the remote before you start working, and </li><li>Commit and push often</li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="programming-tasks-overview"></a>Programming tasks overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#programming-tasks-overview" title="Direct link to heading">#</a></h3><p>There are 6 main parts to this project, each thoroughly described below. Here is a high level overview of the implementation requirements that you can use as a checklist as your team works through the project parts. </p><ol><li><em><a href="#io-functions">I/O functions:</a></em> We have provided complete header file <code>io.h</code> and mostly empty implementation file <code>io.c</code>. Add implementations for the functions that appear in the header file to file <code>io.c</code> according to the descriptions below.</li><li><em><a href="#wave-functions">Wave functions:</a></em> We have provided complete header file <code>wave.h</code> and partial implementation file <code>wave.c</code>. The implementation of two functions, <code>write_wave_header</code> and <code>read_wave_header</code> are included in <code>wave.c</code>. Your task for this part is to add implementations of the other functions to <code>wave.c</code>, using the functions you wrote for part 1.<ul><li><code>compute_pan</code></li><li><code>generate_sine_wave</code></li><li><code>generate_square_wave</code></li><li><code>generate_saw_wave</code></li><li><code>apply_gain</code></li><li><code>apply_adsr_envelope</code></li><li><code>mix_in</code></li></ul></li><li><em><a href="#the-render_tone-program">Tone:</a></em> Write a program called <code>render_tone.c</code> that uses the wave functions to create a continuous tone as specified by the program&#x27;s command-line arguments.</li><li><em><a href="#the-render_song-program">Song:</a></em> Write a program called <code>render_song.c</code> that uses the wave functions to convert a plain text song input file into a wave sound file. Filenames are supplied as command-line arguments.</li><li><em><a href="#the-render_echo-program">Echo:</a></em> Write a program called <code>render_echo.c</code> that uses the wave functions to convert a wave sound file into a new one that echos the original as specified by the command-line arguments.</li><li><em><a href="#packaging-and-submission-requirements">Makefile:</a></em> Create a makefile with the specified targets for the three render programs above.</li></ol><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="sound"></a>Sound<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sound" title="Direct link to heading">#</a></h1><p>This section has some background about sound and how it can be represented digitally.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="what-sound-is"></a>What sound is<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-sound-is" title="Direct link to heading">#</a></h2><p>Sound is changes in air pressure over time.  When physical objects
vibrate, they cause oscillations in air pressure that propagate outwards
in a wave.  A sensor such as a microphone or your ear can detect these
changes in pressure over time.</p><p>The most basic type of oscillation is a sine wave, where the changes in
pressure over time are modeled by the equation</p><p><em>p</em> = <em>a</em> Ã— sin(<em>tf</em> Ã— 2Ï€)</p><p>where <em>p</em> is pressure, <em>t</em> is time, <em>f</em> is frequency, and <em>a</em> is
amplitude.  Because the sine function yields both positive and negative
values, the resulting pressure values (<em>p</em>) can be both positive and
negative.  The pressure values represent the instantaneous air pressure
relative to the overall average air pressure.</p><p>Plotted with time on the x-axis and pressure on the y-axis, a sine wave
looks like this:</p><p><img alt="Sine wave" src="/cs220-sp21/assets/images/sound-sinewave-852e6c6a751de54a079f42afd2f270a1.png"></p><p>A <em>cycle</em> consists of one full oscillation with both positive and negative peaks:</p><p><img alt="Sine wave cycle" src="/cs220-sp21/assets/images/sound-sinewave-cycles-2c4fc7ee671d8fba7ee1cd002fe2528e.png"></p><p>When the frequency increases, the cycles become shorter, so there are more
cycles per unit of time.  The standard measurement of frequency, the Hertz
(abbreviated Hz), is defined as one cycle per second.  Sound waves have
frequencies that range from the low tens of Hz to tens of thousands of Hz.
We perceive sounds with higher frequencies as being higher-pitched.</p><p>Here is what one second of a 440 Hz sine wave sounds like:</p><audio controls=""><source src="/cs220-sp21/snd/a440.wav"></audio><div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="complex-audio-waveforms"></a>Complex audio waveforms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#complex-audio-waveforms" title="Direct link to heading">#</a></h3><p>Obviously real sounds are much more complex than just plain sine waves.
In general, any sound can be represented by the <em>sum</em> of sine waves of
varying frequencies and amplitudes.  Here is one second of a 440 Hz sine
wave mixed with a 587.33 Hz sine wave:</p><audio controls=""><source src="/cs220-sp21/snd/a440_third.wav"></audio><div></div><p>At a physical level, the air pressure changes as the <em>sum</em> of the pressure
changes induced by all of the sine waves being generated.  Humans can
effectively hear multiple tones at the same time, deconstructing the
added sine waves into the constituent frequencies.  The example you just
heard (440 Hz and 587.33 Hz) is two tones separated by a <em>major third</em>,
an important frequency interval in western music.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="digital-sound"></a>Digital sound<a aria-hidden="true" tabindex="-1" class="hash-link" href="#digital-sound" title="Direct link to heading">#</a></h3><p>There are a variety of ways to represent sound using a computer.
The most straightforward way is using linear <a href="https://en.wikipedia.org/wiki/Pulse-code_modulation" target="_blank" rel="noopener noreferrer">pulse code
modulation</a>,
where sound is represented as a sequence of <em>samples</em>, each sample
representing air pressure at a moment in time.  The <em>sampling frequency</em>
determines how many (evenly spaced) samples there are per unit of time.
CD quality audio, a common PCM format, uses signed 16 bit samples
(ranging from -32,768 to 32,767) and a sampling frequency of 44.1 KHz
(44,100 samples per second).  In C, the <code>int16_t</code> data type (defined in
the <code>&lt;stdint.h&gt;</code> header file) matches the range of sample data values
for CD quality audio.  So, an array of <code>int16_t</code> elements can represent
CD quality audio: each 44,100 elements represent one second of monaural audio
or one half second of stereo audio.</p><p>To make this idea explicit, let&#x27;s say that the sound we want to represent
is a sine wave with an amplitude of 0.1 and a frequency of 440 Hz.
We&#x27;ll consider amplitude as being relative to the loudest possible sound,
defined as 1.0, so a signal with an amplitude of 0.1 has positive and
negative peaks that are 10% as large as the loudest possible signal.
With a sampling frequency of 44.1 KHz, each cycle of our 440 Hz audio
signal will be represented by about 100 samples (really 100.22727...).  The values of the
individual samples will vary between (approximately) -3,276 and 3,276.
Let&#x27;s say the audio data is in an array of <code>int16_t</code> elements called
<code>sound</code>.  Here is a diagram showing several points on the first cycle
of the signal, their values, and which array elements they would be
stored in:</p><p><img alt="Sine wave with samples" src="/cs220-sp21/assets/images/sound-sinewave-samples-836e8f3c7a1ca1c2e71bd0fd27d6a69c.png"></p><p>As long as the number of bits per sample is reasonably large, and the
sampling frequency is reasonably high, PCM can represent audio with a
high degree of fidelity to the original sound.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="mixing-digital-audio-signals-clipping"></a>Mixing digital audio signals, clipping<a aria-hidden="true" tabindex="-1" class="hash-link" href="#mixing-digital-audio-signals-clipping" title="Direct link to heading">#</a></h3><p>Because sound waves interact additively, you can combine two digital
audio signals by simply <em>adding</em> their respective sample values.</p><p>A potential problem that can arise when adding sample values is that
the sum might exceed the maximum positive or negative sample values: for
example, 32,767 and -32,768 for 16 bit signed samples.  If this happens,
we can&#x27;t really fully represent the resulting combined signal.  <em>Clipping</em>
is a phenomenon that results from such overflows, in particular, when we
use <em>saturating</em> addition such that sums greater than the maximum possible
value or less than the minimum possible value (e.g., 32,767/-32,768)
are <em>clamped</em> at the maximum or minimum.</p><p>For example, here is an audio signal where the amplitude exceeds the
range that can be represented, with the minimum and maximum sample values
shown as light blue dashed lines:</p><p><img alt="Audio signal before clipping" src="/cs220-sp21/assets/images/sound-noclip-8a2e991ca0e77b1449e3d2bf8beba436.png"></p><p>Clipping will change the waveform to the following:</p><p><img alt="Audio signal after clipping" src="/cs220-sp21/assets/images/sound-clip-f35397ef050673b7eb36adc61136cec1.png"></p><p>Humans perceive clipping as distortion of the original signals.
Clipping can be avoided by making sure that audio signals being mixed
have relatively small amplitudes, so that the sum of their sample values
never exceeds the range of representable sample values.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="stereo-sound-wave-files"></a>Stereo sound, WAVE files<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stereo-sound-wave-files" title="Direct link to heading">#</a></h3><p>Most sound recordings are <em>stereo</em> meaning that there are separate
left and right audio channels.  A common way to represent stereo audio
is to consider the even-numbered samples (0 being the first sample) as
belonging to the left channel, and the odd-numbered samples as belonging
to the right channel.</p><p>The <a href="http://soundfile.sapp.org/doc/WaveFormat/" target="_blank" rel="noopener noreferrer">WAVE file format</a> is a
common file format for digital audio.  Although a variety of encodings
are possible in WAVE files, they are most commonly used for linear PCM
audio data.  Wave files represent stereo PCM data using the scheme just
described (samples 0, 2, 4, etc. belong to the left channel, samples 1,
3, 5, etc. belong to the right channel.)</p><p>In this project you will write programs to read and write audio data in
the WAVE format.  The good news is that WAVE files are pretty simple:
they consist of a <em>header</em> followed by raw sample data.  Digital audio
programs can represent sound waveforms internally using arrays with
sample data.  To read audio data from a WAVE file, a program needs
to read the header, and then read the raw sample data into an array.
To write audio data to a WAVE file, a program needs to write the header,
and then write the raw sample data from an array.</p><h1><a aria-hidden="true" tabindex="-1" class="anchor" id="functional-requirements"></a>Functional requirements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#functional-requirements" title="Direct link to heading">#</a></h1><p>This section documents the functional requirements of the project.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="io-functions"></a>I/O functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#io-functions" title="Direct link to heading">#</a></h2><p>This section describes the I/O functions that your programs will use to
read binary data and write binary data.  This program module will also
define an error reporting function called <code>fatal_error</code>.  These functions
are declared in <code>io.h</code> and you will need to define them in <code>io.c</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="fatal_error-function"></a><code>fatal_error</code> function<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fatal_error-function" title="Direct link to heading">#</a></h3><p>You can start by implementing (in <code>io.c</code>) the <code>fatal_error</code> function. It
is declared in the <code>io.h</code> header file, as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fatal_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>When this function is called, it should print a line of text to <code>stderr</code> of the form</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error: message text</span></div></div></div></div></div><p>where &quot;message text&quot; is the string passed as the <code>message</code> parameter.
After the message is printed (make sure a newline character is printed
after the message), the function should call</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>to exit the program.  (Exiting with a non-zero exit code is traditionally
how Unix and Linux programs indicate that the program execution was
not successful.)</p><p>The purpose of <code>fatal_error</code> is to immediately exit the program if an
unrecoverable error, such as unexpected input data, is encountered.
Although this is a somewhat heavy handed way of dealing with errors, it
is simple.  We will see a more sohisticated and flexible way of reporting
and handling runtime errors later in the course when we cover <em>exceptions</em>
in C++.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="binary-io-functions"></a>Binary I/O functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#binary-io-functions" title="Direct link to heading">#</a></h3><p>WAVE files are <em>binary</em> files, meaning their contents consist of arbitrary byte values.</p><p>Furthermore, the specific type of WAVE file generated and transformed by
the programs you will implement in this assignment use <em>little-endian</em>
binary data, where multi-byte values are represented as a sequence of
bytes such that less significant bytes occur before more significant
bytes.</p><p>You should start your work by implementing the following binary I/O (input
and output) functions, which are declared in the <code>io.h</code> header file:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_u16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint16_t value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_u32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint32_t value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_s16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int16_t value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_s16_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> int16_t buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_byte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_bytes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_u16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint16_t </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_u32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> uint32_t </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_s16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int16_t </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_s16_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int16_t buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>All of these functions much be implemented exactly as described below.</p><p>The <code>write_byte</code>, <code>write_u16</code>, <code>write_u32</code>, and <code>write_s16</code> functions
write a single data value of type <code>char</code>, <code>uint16_t</code>, <code>uint32_t</code>, or
<code>int16_t</code> respectively.</p><p>Multi-byte data values (<code>uint16_t</code>, <code>uint32_t</code>, <code>int16_t</code>) must be written
in <em>little-endian</em> format, such that less significant bytes are written
before more significant bytes.  Because the ugrad machines use x86-64
CPUs, which are little-endian, you may read and write multi-byte data
values by simply treating them as a sequence of bytes.  For example,
to write a <code>uint32_t</code> stored in a variable <code>x</code> to a <code>FILE *</code> file
handle called <code>out</code>, you could use the code</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">fwrite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">uint32_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>write_</code> functions should call <code>fatal_error</code> if an error occurs while writing data.</p><p>The <code>write_bytes</code> and <code>write_s16_buf</code> functions write a sequence of
<code>char</code> or <code>int16_t</code> values, respectively.
The <code>write_bytes</code> function can be implemented by a single call to
<code>fwrite</code>.  The <code>write_s16_buf</code> function can be implemented by calling
<code>write_s16</code> in a loop, once for each element of the argument array.</p><p>The <code>read_byte</code>, <code>read_u16</code>, <code>read_u32</code>, and <code>read_s16</code> functions read a
single data value of type <code>char</code>, <code>uint16_t</code>, <code>uint32_t</code>, or <code>int16_t</code>,
respectively, storing the value read in a variable whose address is
passed as a pointer parameter to the function.
As with the functions to write multi-byte values, the functions which
read multi-byte data values may assume that the little-endian data values
they read can be directly stored in memory, because we will be running
on a little endian CPU.  For example, if you need to read a 32 bit
unsigned value into a <code>uint32_t</code> variable <code>x</code> from a <code>FILE *</code> file
handle called <code>in</code>, you could use the code</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">fread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">uint32_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The <code>read_bytes</code> and <code>read_s16_buf</code> functions read a sequence of <code>char</code>
or <code>int16_t</code> values, respectively, and store them in the array passed
as a parameter.  <code>read_bytes</code> can be implemented by a single call to
<code>fread</code>.  <code>read_s16_buf</code> can be implemented by calling <code>read_s16</code> in a
loop, once per element.</p><p>If any of the <code>read_</code>  functions fail to read the required number of
data bytes, they should call the <code>fatal_error</code> function.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="wave-functions"></a>Wave functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#wave-functions" title="Direct link to heading">#</a></h2><p>This section describes functions for working with WAVE files and digital
audio waveforms.  This module of the program consists of the header file
<code>wave.h</code> and the source file <code>wave.c</code>.</p><p>The <code>write_wave_header</code> and <code>read_wave_header</code> functions require the
<a href="#binary-io-functions">binary I/O functions</a>, so implement the binary
I/O functions before working on the wave functions.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="waveh"></a><code>wave.h</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#waveh" title="Direct link to heading">#</a></h3><p>The header file <code>wave.h</code>, as distributed in the public repo, has the following contents:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdint.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> PI                 3.14159265358979323846</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SAMPLES_PER_SECOND 44100u</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> NUM_CHANNELS       2u</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> BITS_PER_SAMPLE    16u</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* waveforms */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SINE          0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SQUARE        1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> SAW           2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> NUM_WAVEFORMS 3 </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* one greater than maximum legal waveform */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* timing characteristics for ADSR envelope */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> ATTACK_NUM_SAMPLES  882</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> DECAY_NUM_SAMPLES   882</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> RELEASE_NUM_SAMPLES 882</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Functions for writing and reading a WAVE header.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">write_wave_header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_wave_header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Compute appropriate gains for a stereo pan at given angle in radians.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Left and right channel gains are stored in the channel_gain array.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">compute_pan</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> angle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> channel_gain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Basic full-amplitude wave generation into a mono sample buffer</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_sine_wave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> freq_hz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_square_wave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> freq_hz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_saw_wave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> freq_hz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Scale each sample in a mono sample buffer by specified factor</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apply_gain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> gain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Apply an ADSR envelope to a mono sample buffer. This should only</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// be done *after* attenuating the contents of the buffer to a reasonable</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// level, since the peak of the attack will actually increase the</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// signal&#x27;s amplitude.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apply_adsr_envelope</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Mix a mono sample buffer into a stereo stream.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// channel should be 0 (left) or 1 (right).</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// stereo_buf should be pointing to a left-channel sample.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mix_in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">int16_t stereo_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> int16_t mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The constants <code>SAMPLES_PER_SECOND</code>, <code>NUM_CHANNELS</code>, and <code>BITS_PER_SAMPLE</code>
define the parameters of stereo CD-quality PCM audio.</p><p>The constant <code>PI</code> closely approximates the value of Ï€.</p><p>The constants <code>SINE</code>, <code>SQUARE</code>, and <code>SAW</code> distinguish the three kinds
of audio waveforms that the <code>render_song</code> program can generate.</p><p>The function declarations are for functions defined in <code>wave.c</code>. The
functions are described in more detail below.  Note that you are not required
to implement any of these functions: how you choose to generate
audio waveforms is entirely up to you.  However, these functions
do provide a good basis for implementing the functionality required
in this project.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="read_wave_header-write_wave_header"></a><code>read_wave_header</code>, <code>write_wave_header</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#read_wave_header-write_wave_header" title="Direct link to heading">#</a></h3><p>Two functions called <code>read_wave_header</code> and <code>write_wave_header</code> are
provided (including implementations in <code>wave.c</code>) which, respectively, read
the header information from a WAVE file, and write header information
for a WAVE file.  WAVE files are essentially just header information
followed by a sequence of sample values.</p><p>You can look at the implementation of <code>read_wave_header</code> and
<code>write_wave_header</code> to see how they use your binary I/O functions.
Note that both functions are hard-coded to support only 16 bits per
sample, 44.1 KHz, stereo (two channel) WAVE files.  For our purposes,
the only &quot;interesting&quot; value in the WAVE header is the number of <em>stereo</em>
samples, which determines the length of the audio.  Note that a stereo
sample consists of <em>two</em> 16-bit signed integer values, one for each
channel (left and right).</p><p>Here is a very simple example program that calls <code>read_wave_header</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdio.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdlib.h&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;io.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;wave.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">fprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">stderr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Usage: %s &lt;wave file&gt;\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fopen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rb&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">in </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">fatal_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Couldn&#x27;t open wave file&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">unsigned</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">read_wave_header</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Wave file has %u stereo samples\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">fclose</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>Let&#x27;s say that we compile and link this program as an executable called <code>readwav</code>.  If we run the program on the WAVE file called <a target="_blank" href="/cs220-sp21/assets/files/a440-206ada68784412d709d57893da8f389e.wav">a440.wav</a> as follows</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./readwav a440.wav</span></div></div></div></div></div><p>The output will be</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Wave file has 44100 stereo samples</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="rendering-tones-wave-functions"></a>Rendering tones, wave functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#rendering-tones-wave-functions" title="Direct link to heading">#</a></h3><p>The <code>generate_sine_wave</code>, <code>generate_square_wave</code>, and <code>generate_saw_wave</code> functions, as declared in the initial version of <code>wave.h</code>, are intended to generate full-amplitude sine, square, and sawtooth waveforms with a specified frequency in a specified (mono) sample buffer.  &quot;Full amplitude&quot; means that the sample values should vary over the full range of possible values (-32,768 to 32,767.)</p><p>A square wave is a waveform where the generated sample values oscillate between maximum and minimum sample values (with respect to the amplitude), i.e.</p><p><img alt="Square wave" src="/cs220-sp21/assets/images/sound-square-7cdd1f0f52c1b76a5c3d5750fc41784c.png"></p><p>Square waves are easy to generate using digital electronics, and were used frequently in early home computers and video games.  Here is a 440 Hz square wave:</p><audio controls=""><source src="/cs220-sp21/snd/a440_sq.wav" type="audio/wav"></audio><div></div><p>A sawtooth wave rises steadily from the minimum sample value to the maximum sample value (with respect to amplitude) on each cycle, i.e.</p><p><img alt="Sawtooth wave" src="/cs220-sp21/assets/images/sound-saw-7fe832f1b48f8ea0e78fc130aca71dc4.png"></p><p>Sawtooth waves have a more &quot;horn-like&quot; sound than a plain sine wave.  Here is a 440 Hz sawtooth wave:</p><audio controls=""><source src="/cs220-sp21/snd/a440_saw.wav" type="audio/wav"></audio><div></div><p>The <code>apply_gain</code> function modifies the samples in a mono sample buffer
by scaling them by a specified gain factor. This function is useful for
reducing the amplitude of a full-amplitude waveform.</p><p>The <code>apply_adsr_envelope</code> function applies and ADSR (attack, decay, sustain,
release) envelope to the waveform in a mono sample buffer.
Applying an ADSR envelope to a waveform scales the sample values in the
waveform as illustrated by the following diagram:</p><p><img alt="ADSR envelope" src="/cs220-sp21/assets/images/adsr_envelope-b9b0d82ee6feb5035811a25284723488.png"></p><p>The purpose of the envelope is to give rendered notes a more &quot;natural&quot; sound,
and also to avoid audio artifacts (such as popping) that can occur
when very abrupt volume changes occur.
During the attack phase (labeled &quot;A&quot; in the diagram), the gain increases
from 0 to 1.2.  So, the perceived volume of the waveform will increase from
0 to 1.2 times the &quot;real&quot; volume during this interval.  During the
decay phase (labeled &quot;D&quot; in the diagram), the gain falls from 1.2 to 1.0.
During the sustain phase, the gain is 1.0 (meaning no change to the
samples in this interval.)  During the release phase (labeled &quot;R&quot;
in the diagram), the gain falls from 1.0 to 0.0.  The constants <code>ATTACK_NUM_SAMPLES</code>,
<code>DECAY_NUM_SAMPLES</code>, and <code>RELEASE_NUM_SAMPLES</code> specify the number of samples
in the attack, release, and decay phases.  All of the samples not in the
attack, release, or decay phases are considered to be in the sustain phase.</p><p>As a special case, if an ADSR envelope is applied to a waveform that is not
long enough to include full attack, decay, and release phases, a simpler &quot;rise/fall&quot;
envelope should be applied.  In this type of envelope, the gain should increase
from 0.0 to 1.0 during the first half of the waveform, and fall from 1.0 to 0.0
in the second half of the waveform.</p><p>The <code>mix_in</code> function takes a rendered mono waveform and mixes it into one channel
of a stereo sample buffer.  Channel 0 is the left channel, and channel 1 is the right
channel.  This function should ensure that sample values stay in the range
-32,768 to 32,767, clamping them at these minimum and maximum values if necessary.</p><p>The <code>compute_pan</code> function computes appropriate gain factors for the
left and right channels, according to a <em>pan angle</em> specified in radians.
This function should use the following gain formulas, where <em>Î¸</em> is the
pan angle, and <em>L</em> and <em>R</em> are the computed left and right channel gain factors:</p><p><em>L</em> = âˆš2/2 Ã— (cos Î¸ + sin Î¸)</p><p><em>R</em> = âˆš2/2 Ã— (cos Î¸ - sin Î¸)</p><p>The <code>render_song</code> program will allow instrument sounds to be panned, so
being able to compute appropriate channel gain factors will be important
for that program.</p><p><strong>Important</strong>: Note that you do not need to implement any of these
functions exactly as described above.  You will need to
implement functions to generate tones, but you are free to implement
them in whatever way you think is appropriate.  Having said that,
the functions described above, if you implement them, will allow
you to complete the required programs in a fairly straightforward way.</p><p><strong>Recommendation</strong>: Don&#x27;t implement all of the audio generation functions
at once.  Implement them as needed to support the three programs you
will be implementing, <code>render_tone</code>, <code>render_song</code>, and <code>render_echo</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="hints-on-how-to-render-waveforms"></a>Hints on how to render waveforms<a aria-hidden="true" tabindex="-1" class="hash-link" href="#hints-on-how-to-render-waveforms" title="Direct link to heading">#</a></h3><p>Rendering sine waves is relatively straightforward, since you can use the equation</p><p><em>p</em> = <em>a</em> Ã— sin(<em>tf</em> Ã— 2Ï€)</p><p>more or less directly.  The main thing you&#x27;ll need to think about is how
to convert a sample number into a time value <em>t</em>.  (Hint: the number of
samples in one second of audio is defined by the <code>SAMPLES_PER_SECOND</code>
constant.)  Also, because <em>p</em> will range from -1.0 to 1.0, you&#x27;ll need
to scale it appropriately to fit the range of the <code>int16_t</code> data type.</p><p>You can think of square waves as being modified sine waves:</p><ul><li>For any sample where a sine wave would have a non-negative value,
the square wave should have a &quot;maximum&quot; value (with respect to amplitude)</li><li>For any sample where a sine wave would have a negative value, the
square wave should have a &quot;minimum&quot; value (with respect to amplitude)</li></ul><p>The sample values generated for sawtooth waves should increase linearly
from the minimum to maximum throughout each cycle.  One way to implement
this is to take the time <em>t</em> of the sample, and divide it by the length
of one cycle.  For example, let&#x27;s say the frequency is 440 Hz, which
would make the cycle length 1/440 seconds.  If <em>t</em> is 4.9902 seconds,
then dividing <em>t</em> by the cycle length gives us approximately 2195.688000.
Subtracting the <em>floor</em> of this value gives us 0.688.  What this means
is that for our value of <em>t</em> (4.9902 seconds), the generated sawtooth
waveform about 2/3 of the way through the current cycle (0.688 is
about 2/3.)  Knowing where <em>t</em> is within the current cycle allows us to
compute an appropriate sample value.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="mixing-is-additive"></a>Mixing is additive!<a aria-hidden="true" tabindex="-1" class="hash-link" href="#mixing-is-additive" title="Direct link to heading">#</a></h3><p>The <code>generate_sine_wave</code>, <code>generate_square_wave</code>, and <code>generate_saw_wave</code>
functions render a basic waveform in an uninitialized mono sample buffer.
Because these functions aren&#x27;t intended to combine the generated waveform
with existing audio data, they can unconditionally assign computed sample values
to the elements of the sample buffer.</p><p>The <code>apply_gain</code> and <code>apply_adsr_envelope</code>
functions modify the sample values in a mono sample buffer, which will
typically be a buffer already initialized by one of the <code>generate_</code>
functions.</p><p>The <code>mix_in</code> function is where a waveform is mixed (combined) with other
audio signals.  This function should <em>add</em> the sample values in the
specified mono sample buffer with either the left or right sample
values in the specified stereo sample buffer.  This &quot;mixing&quot; process
allows new waveforms to combine with existing waveform, building layers
of sound in the resulting stereo audio output.</p><p>There are a couple of things you should think about in order to make mixing
work correctly:</p><ul><li>Every element of the stereo sample buffer should be initialized to 0.
This means that both channels of the stereo buffer (left and right)
will contain only silence.</li><li>If the result of adding a new sample value to an existing sample
value is either greater than 32,767 or less than -32,768 (these are
the maximum and minimum <code>int16_t</code> values, respectively), then your code
should clamp the result at 32,767 or -32,768.  (See the <a href="#sound">Sound</a>
section for details.)  To detect when a computed sample value is outside
the legal range, your code will need to do the addition using a data
type with a larger range of possible values (e.g., <code>int32_t</code>.)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-render_tone-program"></a>The <code>render_tone</code> program<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-render_tone-program" title="Direct link to heading">#</a></h2><p>The <code>render_tone</code> program renders a continuous tone with a specified
waveform, frequency, amplitude, and duration.  This section describes the
requirements for the <code>render_tone</code> program.  This program will be a good
way for you to validate the implementations of the <a href="#wave-functions">wave functions</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="invocation-of-render_tone"></a>Invocation of <code>render_tone</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#invocation-of-render_tone" title="Direct link to heading">#</a></h3><p>The program is invoked as</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone waveform frequency amplitude numsamples wavfileout</span></div></div></div></div></div><p>The <code>waveform</code> argument is an integer specifying the waveform shape to
generate: 0 for sine wave, 1 for square wave, 2 for sawtooth wave.
(See the <a href="#wave-functions">WAVE functions</a> section for information about how
to generate sine, square, and sawtooth waves.)</p><p>The <code>frequency</code> argument is a floating-point value
specifying the frequency of the tone in Hz (cycles per second.)</p><p>The <code>amplitude</code> argument is a floating-point value
specifying the relative amplitude of the tone, with 0.0 being complete
silence, to 1.0 being maximum volume.</p><p>The <code>numsamples</code> argument is the number of stereo samples
to generate.  Because the sampling frequency is fixed at 44.1 KHz,
there are 44,100 stereo samples per second.  (Remember that a stereo
sample consists of two signed 16-bit values, one for each audio channel.)</p><p>The <code>wavfileout</code> argument specifies the name of the output
WAVE file to generate.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_tone-examples"></a><code>render_tone</code> examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_tone-examples" title="Direct link to heading">#</a></h3><p>Here are some examples of invoking the <code>render_tone</code> program and what
the resulting wave file should sound like.</p><p>Rendering a 130.81 Hz sine wave:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">130.81</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">44100</span><span class="token plain"> c131_sine.wav</span></div></div></div></div></div><p>Resulting audio:</p><audio controls=""><source src="/cs220-sp21/snd/c131_sine.wav" type="audio/wav"></audio><div></div><p>Rendering a 130.81 Hz square wave:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">130.81</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">44100</span><span class="token plain"> c131_sq.wav</span></div></div></div></div></div><p>Resulting audio:</p><audio controls=""><source src="/cs220-sp21/snd/c131_sq.wav" type="audio/wav"></audio><div></div><p>Rendering a 130.81 Hz sawtooth wave:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_tone </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">130.81</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">44100</span><span class="token plain"> c131_saw.wav</span></div></div></div></div></div><p>Resulting audio:</p><audio controls=""><source src="/cs220-sp21/snd/c131_saw.wav" type="audio/wav"></audio><div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_tone-suggested-approach"></a><code>render_tone</code> suggested approach<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_tone-suggested-approach" title="Direct link to heading">#</a></h3><p>First, the program should allocate an appropriately-sized mono sample buffer,
and call either <code>generate_sine_wave</code>, <code>generate_square_wave</code>, or
<code>generate_saw_wave</code> to generate an appropriate waveform.  It should also
call the <code>apply_gain</code> function so that the waveform has the specified
amplitude.</p><p>Next, the program should create a stereo sample array of an appropriate length
(make sure the sample values are initially zero!), and call <code>mix_in</code> to
incorporate the waveform into both the left and right channels.</p><p>Finally, the program should open the output file, call the <code>write_wave_header</code>
function to write the WAVE header, then write the stereo sample data.</p><p>Make sure that the program frees all allocated memory and closes any file
that was opened.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-render_song-program"></a>The <code>render_song</code> program<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-render_song-program" title="Direct link to heading">#</a></h2><p>This document describes the <code>render_song</code> program.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="invocation-input-data-format"></a>Invocation, input data format<a aria-hidden="true" tabindex="-1" class="hash-link" href="#invocation-input-data-format" title="Direct link to heading">#</a></h3><p>The <code>render_song</code> program, whose <code>main</code> function should be defined in
<code>render_song.c</code>, is invoked as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_song songinput waveoutput</span></div></div></div></div></div><p>The file <code>songinput</code> is a text file describing a &quot;song&quot;.
The first value in a song file is the total number of samples.
For example, if this value is</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">352800</span></div></div></div></div></div><p>then the song is 352,800 samples long.  With the fixed 44.1 KHz sample rate,
this means that the song is exactly 8 seconds long.</p><p>Next, the song file will have a series of <em>directives</em>.  The following directives
should be supported:</p><ul><li><code>N instrument start end note gain</code>: render a note using specified
<code>instrument</code>, starting at sample number <code>start</code>, ending just before sample
<code>end</code>, playing MIDI note number <code>note</code>, with specified <code>gain</code> factor</li><li><code>W instrument waveform</code>: set the waveform of specified instrument, 0 for
sine, 1 for square, 2 for sawtooth</li><li><code>P instrument angle</code>: set the stereo pan angle (in radians) of specified instrument</li><li><code>E instrument enable</code>: enable or disable ADSR envelope on specified instrument
(0 to disable, 1 to enable)</li><li><code>G instrument gain</code>: set the gain factor (0.0 to 1.0) of specified instrument</li></ul><p>All of the numeric values specified in directives are unsigned integers,
with the exception of <code>gain</code> and <code>angle</code>, which are floating point.</p><p>There are 16 possible instruments that could be used in a song, numbered 0 through 15.  By default each instrument:</p><ul><li>Uses the sine waveform</li><li>Has its pan angle set to 0.0 (centered)</li><li>Has the ADSR envelope disabled</li><li>Has its gain set to 0.2</li></ul><p>The <code>W</code>, <code>P</code>, <code>E</code>, and <code>G</code> directives modify the characteristics of a specified instrument.</p><p>A <a href="https://newt.phys.unsw.edu.au/jw/notes.html" target="_blank" rel="noopener noreferrer">MIDI note number</a> <em>n</em> can be converted to a frequency <em>f</em> using the following formula:</p><p><em>f</em> = 440 Ã— 2<sup>(<i>n</i>-69) / 12</sup></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_song-example"></a><code>render_song</code> example<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_song-example" title="Direct link to heading">#</a></h3><p>Here is a fairly simple song:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">352800</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">W 0 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">E 0 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">P 0 -0.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">W 1 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">E 1 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">P 1 0.4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 0 8820 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 0 8820 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 22050 30870 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 22050 30870 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 44100 52920 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 44100 52920 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 66150 74970 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 66150 74970 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 88200 97020 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 88200 97020 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 110250 119070 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 110250 119070 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 132300 141120 63 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 132300 141120 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 154350 163170 61 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 154350 163170 65 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 176400 194040 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 176400 194040 70 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 220500 238140 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 1 220500 238140 70 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 264600 282240 66 0.8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">N 0 264600 282240 70 0.8</span></div></div></div></div></div><p>Note that there are two instruments, 0 and 1.  ADSR envelopes are enabled for
both instruments.  Instrument 0 plays notes using a square wave, and is panned
at angle -0.4.  Instrument 1 plays notes using a sawtooth wave, and is panned
at angle 0.4.  If we save this song in a file called <code>example.txt</code>, we can
render it as a wave file using the command</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_song example.txt example.wav</span></div></div></div></div></div><p>The result sounds like this:</p><audio controls=""><source src="/cs220-sp21/snd/example.wav" type="audio/wav"></audio><div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="important-struct-requirement"></a>Important <code>struct</code> requirement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#important-struct-requirement" title="Direct link to heading">#</a></h3><p>It is a requirement for this program that you use a <code>struct</code> data type
(suggestion: call it <code>struct Instrument</code>) to represent the information about each instrument. Then, by declaring an array of elements of this type:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">struct</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">Instrument</span><span class="token plain"> instruments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>you can represent all of the required information about each of the 16
possible instruments.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_song-suggested-approach"></a><code>render_song</code> suggested approach<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_song-suggested-approach" title="Direct link to heading">#</a></h3><p>The program should open the input text file and read the duration from it.
It can use the duration to create a stereo sample array of an appropriate
length.</p><p>The program&#x27;s main loop should read directives one at a time and process them.</p><p><code>N</code>  directives can be carried out by calling <code>generate_sine_wave</code>,
<code>generate_square_wave</code>, or <code>generate_saw_wave</code> to render the note into
a mono sample buffer, calling <code>apply_gain</code> to scale the samples according
to the instrument and note gain values, calling <code>apply_adsr_envelope</code>
if appropriate (depending on whether it is enabled for the instrument
being played), calling <code>compute_pan</code> to compute the appopriate channel
gain values according to the instruments pan angle, then incorporating
the mono sample values into each channel with the correct sample gain.
(If you use the <code>mix_in</code> function to do this, you will probably need
to allocate a separate mono sample buffer to hold the samples scaled
correctly for the output channel.)</p><p><code>W</code>, <code>P</code>, <code>E</code>, and <code>G</code> directives should modify the appropriate instance
of the struct type representing instruments. Any modifications to an instrument through one of these input lines will only affect the notes that follow the directive. In other words, it is possible for instrument directives that begin with <code>W</code>, <code>P</code>, <code>E</code>, and <code>G</code> to be mixed with note directives (lines that begin with <code>N</code>). It is also possible for the input file to contain blank lines. Each line should be processed simply according to its first character. If the program encounters the end of file when attempting to read a directive character, it means that the song has ended.</p><p>If the input is malformed (ie, invalid directive character or invalid/missing data for a particular directive), the program should call the <code>fatal_error</code> function.</p><p>Make sure that all memory is freed and file(s) closed before the program exits.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="the-render_echo-program"></a>The <code>render_echo</code> program<a aria-hidden="true" tabindex="-1" class="hash-link" href="#the-render_echo-program" title="Direct link to heading">#</a></h2><p>This section describes the requirements for the <code>render_echo</code> program.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="invocation"></a>Invocation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#invocation" title="Direct link to heading">#</a></h3><p>The <code>render_echo</code> program processes an input WAVE file to generate an echo effect, and is invoked as follows:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo wavfilein wavfileout delay amplitude</span></div></div></div></div></div><p>The <code>wavfilein</code> argument names an input WAVE file.</p><p>The <code>wavfileout</code> argument names an output WAVE file to write,
which will be a transformed version of <code>wavfilein</code>.</p><p>The <code>delay</code> argument is an integer delay, specified as a number of samples.</p><p>The <code>amplitude</code> argument is a floating point value in the range 0.0 to 1.0,
specifying a relative amplitude of the echo effect to generate.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="generating-an-echo"></a>Generating an echo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#generating-an-echo" title="Direct link to heading">#</a></h3><p>Generating an echo is straightforward: the program should add an attenuated copy of
the audio signal at an offset as indicated by the <code>delay</code>
argument.  For example, if <code>delay</code> is 22050, that
indicates a delay of 0.5 seconds.  The amplitude of the copied signal
is specified by the <code>amplitude</code> argument.  For example,
if <code>amplitude</code> is 0.4, then the echoed copy of the signal
should be 40% of the amplitude of the original.</p><p>Note that the output will need to be <code>delay</code> number of samples longer than
the input, in order to ensure that echoes of samples at the end of the original
file are rendered.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="examples"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples" title="Direct link to heading">#</a></h3><p>As an example, let&#x27;s say that <code>example.wav</code> is the original version of the
example song described in <a href="#the-render_song-program">the render_song program</a>, and we run the command</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo example.wav example_echo.wav 11025 0.4</span></div></div></div></div></div><p>Recall that the original sounded like this:</p><audio controls=""><source src="/cs220-sp21/snd/example.wav" type="audio/wav"></audio><div></div><p>The result is this:</p><audio controls=""><source src="/cs220-sp21/snd/example_echo.wav" type="audio/wav"></audio><div></div><p>The following (famous!) audio clip was used to test sound support early
in the development of the Linux operating system:</p><audio controls=""><source src="/cs220-sp21/snd/linux.wav" type="audio/wav"></audio><div></div><p>Assuming that this file is called <code>linux.wav</code>, we could add an echo with a 0.5
second delay with the command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo linux.wav linux_echo.wav 22050 0.4</span></div></div></div></div></div><p>This yields the following result:</p><audio controls=""><source src="/cs220-sp21/snd/linux_echo.wav" type="audio/wav"></audio><div></div><p>We can add an additional echo with a 0.25 second delay with the command:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./render_echo linux_echo.wav linux_echo2.wav 11025 0.4</span></div></div></div></div></div><p>The result of this second command is the following:</p><audio controls=""><source src="/cs220-sp21/snd/linux_echo2.wav" type="audio/wav"></audio><div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="render_echo-suggested-approach"></a><code>render_echo</code> suggested approach<a aria-hidden="true" tabindex="-1" class="hash-link" href="#render_echo-suggested-approach" title="Direct link to heading">#</a></h3><p>Your program will need to open the input file, call <code>read_wave_header</code>
to read the WAVE header and get the number of (stereo) samples, then read
the sample data into an array.  Adding the echo effect can be accomplished
by adding attenuated sample values to the sample value at a later audio
position, effectively mixing the echo into the original audio.  Note that
you need to be careful about the order in which you process the samples!</p><p>Once the sample data has been updated, open the output file, call
<code>write_wave_header</code> to write the WAVE header, then write the updated
sample values.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="testing"></a>Testing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>This section describes how you can test your programs.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="getting-files-to-your-local-computer"></a>Getting files to your local computer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-files-to-your-local-computer" title="Direct link to heading">#</a></h3><p>If you develop, compile, and test your programs on one of the ugrad
machines, you will need to copy the output WAVE file to your local
machine so you can play it using a media player program.</p><p>Let&#x27;s say that your local repository (cloned from your team&#x27;s private
Github repository) is in the <code>midterm_proj</code> directory of your ugrad account.
Also, let&#x27;s say that you want to listen to a generated WAVE file called
<code>ticktock.wav</code> that you generated in <code>midterm_proj</code>.  You&#x27;ll need to
use either the <code>scp</code> or <code>pscp</code> command to copy the file onto your local
machine.  For example, on your local machine type:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">scp</span><span class="token plain"> username@ugradx.cs.jhu.edu:midterm_proj/ticktock.wav </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">.</span></div></div></div></div></div><p>(Obviously, replace <code>username</code> with your username. Remember to add -P 22 to specify port 22 if you normally do that for <code>[p]scp</code>.)</p><p>Once you&#x27;ve copied the file onto your local machine, it&#x27;s very likely
that double-clicking it in a file browser will launch a program (VLC,
Windows media player, etc.) capable of playing it.</p><p>If you&#x27;re working around other people, you should use headphones or earbuds
so that you can listen to the generated audio without disturbing them.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="example-files"></a>Example files<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-files" title="Direct link to heading">#</a></h3><p>The following example files are available.  All of them are available
from the <code>midterm</code> directory in the public git repository.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="song-files"></a>Song files<a aria-hidden="true" tabindex="-1" class="hash-link" href="#song-files" title="Direct link to heading">#</a></h3><p>Here are some song files you can use as input to your <a href="#the-render_song-program">render_song</a> program.</p><table><thead><tr><th>Filename</th><th>Description</th></tr></thead><tbody><tr><td><code>a440.txt</code></td><td>Generate 440 Hz sine wave, output should be <a target="_blank" href="/cs220-sp21/assets/files/a440-206ada68784412d709d57893da8f389e.wav">a440.wav</a></td></tr><tr><td><code>a440_sq.txt</code></td><td>Generate 440 Hz square wave, output should be <a target="_blank" href="/cs220-sp21/assets/files/a440_sq-e1f9a34f3f8a1a606cdc753bc0ddcab7.wav">a440_sq.wav</a></td></tr><tr><td><code>a440_saw.txt</code></td><td>Generate 440 Hz sawtooth wave, output should be <a target="_blank" href="/cs220-sp21/assets/files/a440_saw-b68ae9dcb547aabfcbbd8b21d768ee1f.wav">a440_saw.wav</a></td></tr><tr><td><code>example.txt</code></td><td>Example song described above, output should be <a target="_blank" href="/cs220-sp21/assets/files/example-f8705e42c8bd6b0ff6604db5900d4aa9.wav">example.wav</a></td></tr><tr><td><code>tocc_dm.txt</code></td><td>Toccata and Fugue in D Minor (BWV 538), output should be <a target="_blank" href="/cs220-sp21/assets/files/tocc_dm-b24744eb676478fd0a106d6d37b39059.mp3">tocc_dm.mp3</a></td></tr><tr><td><code>bwv645.txt</code></td><td>Wachet auf, ruft uns die Stimme (BWV 645), output should be <a target="_blank" href="/cs220-sp21/assets/files/bwv645-7c47abc58f46e925e50d8f302dbcf3b8.mp3">bwv645.mp3</a></td></tr></tbody></table><p>Note that in the case of the larger songs, the &quot;expected&quot; output is in MP3 format
to save space.  Because MP3 involves lossy compression, the audio frequencies
and amplitudes aren&#x27;t exactly the same as in the original uncompressed
WAVE file, but to a human listener they will sound very close.</p><p>You should make your own song files, too!</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="sound-files"></a>Sound files<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sound-files" title="Direct link to heading">#</a></h3><p>The <a href="#the-render_echo-program">render_echo</a> program requires a WAVE file
as input.  You can use any of the files linked above (except for the MP3 files),
or one of the following files:</p><table><thead><tr><th>Filename</th><th>Description</th></tr></thead><tbody><tr><td><code>linux.wav</code></td><td>Linus Torvalds explaining how to pronounce &quot;Linux&quot;</td></tr><tr><td><code>linux_echo.wav</code></td><td>Output of <code>./render_echo linux.wav linux_echo.wav 22050 0.4</code></td></tr><tr><td><code>linux_echo2.wav</code></td><td>Output of <code>./render_echo linux_echo.wav linux_echo2.wav 11025 0.4</code></td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="tips"></a>Tips<a aria-hidden="true" tabindex="-1" class="hash-link" href="#tips" title="Direct link to heading">#</a></h2><p>This section has some useful tips and tricks to consider as you work on the project.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="passing-part-of-an-array-to-a-function"></a>Passing part of an array to a function<a aria-hidden="true" tabindex="-1" class="hash-link" href="#passing-part-of-an-array-to-a-function" title="Direct link to heading">#</a></h3><p>Because arrays are passed as pointers (where the pointer points to
the first element of the array), you can pass <em>part</em> of an array to a
function by passing a pointer to one of the array&#x27;s elements.</p><p>For example, let&#x27;s say that you want to call the <code>mix_in</code> function
to mix the samples in a mono sample buffer into channel 0 (the
left channel) of a stereo sample buffer, starting at a specified sample.
The call might look something like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mix_in</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">stereo_buf </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">start </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> mono_buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The starting sample number is multiplied by 2 because the stereo sample
buffer contains pairs of samples.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="math-functions"></a>Math functions<a aria-hidden="true" tabindex="-1" class="hash-link" href="#math-functions" title="Direct link to heading">#</a></h3><p>Standard math functions such as <code>sin</code>, <code>pow</code>, <code>floor</code>, and potentially
others will be useful for rendering waveforms.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="converting-command-line-arguments-to-numeric-values"></a>Converting command line arguments to numeric values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#converting-command-line-arguments-to-numeric-values" title="Direct link to heading">#</a></h3><p>The <code>render_tone</code> and <code>render_echo</code> programs both take command line
arguments which need to be converted to a numeric value.  The <code>sscanf</code>
function (available if you include the <code>&lt;stdio.h&gt;</code> header) is
very useful for this purpose, since it reads text data from a character
string.</p><p>For example: the <code>render_tone</code> program&#x27;s second command line argument is a
floating point value specifying the frequency of the generated tone.  Your
<code>main</code> function could use code like the following to get the frequency:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">float</span><span class="token plain"> freq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">sscanf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%f&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">freq</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">fatal_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Invalid frequency&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>Note that you will need to be careful about using the correct placeholder,
depending on the type of the variable you want to use to store the data.
For example, to read a floating-point value into a <code>double</code> variable,
you need to use the <code>%lf</code> placeholder.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="use-binary-mode-for-input-and-output"></a>Use binary mode for input and output<a aria-hidden="true" tabindex="-1" class="hash-link" href="#use-binary-mode-for-input-and-output" title="Direct link to heading">#</a></h3><p>For reading and writing binary files such as WAVE files, make sure you
use &quot;b&quot; in the file mode.  For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">in </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fopen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;input.wav&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rb&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">out </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fopen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;output.wav&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wb&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The &quot;b&quot; flag is optional on Unix systems (including Linux and MacOS),
but is necessary on some systems (such as Windows).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="packaging-and-submission-requirements"></a>Packaging and submission requirements<a aria-hidden="true" tabindex="-1" class="hash-link" href="#packaging-and-submission-requirements" title="Direct link to heading">#</a></h2><p>This section describes the packaging and submission requirements.</p><p>Your project must include a <code>Makefile</code> which has targets which build the
<code>render_tone</code>, <code>render_song</code>, and <code>render_echo</code> programs.  These targets
must specify dependencies on the appropriate object (<code>.o</code>) files.
The targets for object files must have appropriate dependencies on a
source (<code>.c</code>) file and any header (<code>.h</code>) files used directly or indirectly
in compiling the object file.</p><p>Your <code>Makefile</code> must also have a <code>clean</code> target which deletes all
object (<code>.o</code>) files and executables (<code>render_tone</code>, <code>render_song</code>, and
<code>render_echo</code>.)</p><p>Keep in mind that your programs will need to link with the math library,
so add <code>-lm</code> to your linking commands.</p><p>Your project must include a <code>README</code> file that contains your names and JHED IDs
and briefly explains each team member&#x27;s contributions to the project.</p><p>To submit, first generate a Git log:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> log </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> gitlog.txt</span></div></div></div></div></div><p>Then create a zipfile with with your <code>.c</code> files, <code>.h</code> files, <code>Makefile</code>, <code>README</code>, and Git log:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">zip</span><span class="token plain"> midterm_proj.zip Makefile *.c *.h README gitlog.txt</span></div></div></div></div></div><p>Upload <code>midterm_proj.zip</code> to Gradescope as <strong>Midterm project</strong>.</p><p>Make sure that you do <strong>not</strong> submit any WAVE (<code>.wav</code>) files.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#getting-started" class="table-of-contents__link">Getting started</a><ul><li><a href="#set-up-your-midterm-project-git-repository" class="table-of-contents__link">Set up your midterm project git repository</a></li><li><a href="#get-the-starter-codes-from-the-public-repository" class="table-of-contents__link">Get the starter codes from the public repository</a></li><li><a href="#programming-tasks-overview" class="table-of-contents__link">Programming tasks overview</a></li></ul></li><li><a href="#what-sound-is" class="table-of-contents__link">What sound is</a><ul><li><a href="#complex-audio-waveforms" class="table-of-contents__link">Complex audio waveforms</a></li><li><a href="#digital-sound" class="table-of-contents__link">Digital sound</a></li><li><a href="#mixing-digital-audio-signals-clipping" class="table-of-contents__link">Mixing digital audio signals, clipping</a></li><li><a href="#stereo-sound-wave-files" class="table-of-contents__link">Stereo sound, WAVE files</a></li></ul></li><li><a href="#io-functions" class="table-of-contents__link">I/O functions</a><ul><li><a href="#fatal_error-function" class="table-of-contents__link"><code>fatal_error</code> function</a></li><li><a href="#binary-io-functions" class="table-of-contents__link">Binary I/O functions</a></li></ul></li><li><a href="#wave-functions" class="table-of-contents__link">Wave functions</a><ul><li><a href="#waveh" class="table-of-contents__link"><code>wave.h</code></a></li><li><a href="#read_wave_header-write_wave_header" class="table-of-contents__link"><code>read_wave_header</code>, <code>write_wave_header</code></a></li><li><a href="#rendering-tones-wave-functions" class="table-of-contents__link">Rendering tones, wave functions</a></li><li><a href="#hints-on-how-to-render-waveforms" class="table-of-contents__link">Hints on how to render waveforms</a></li><li><a href="#mixing-is-additive" class="table-of-contents__link">Mixing is additive!</a></li></ul></li><li><a href="#the-render_tone-program" class="table-of-contents__link">The <code>render_tone</code> program</a><ul><li><a href="#invocation-of-render_tone" class="table-of-contents__link">Invocation of <code>render_tone</code></a></li><li><a href="#render_tone-examples" class="table-of-contents__link"><code>render_tone</code> examples</a></li><li><a href="#render_tone-suggested-approach" class="table-of-contents__link"><code>render_tone</code> suggested approach</a></li></ul></li><li><a href="#the-render_song-program" class="table-of-contents__link">The <code>render_song</code> program</a><ul><li><a href="#invocation-input-data-format" class="table-of-contents__link">Invocation, input data format</a></li><li><a href="#render_song-example" class="table-of-contents__link"><code>render_song</code> example</a></li><li><a href="#important-struct-requirement" class="table-of-contents__link">Important <code>struct</code> requirement</a></li><li><a href="#render_song-suggested-approach" class="table-of-contents__link"><code>render_song</code> suggested approach</a></li></ul></li><li><a href="#the-render_echo-program" class="table-of-contents__link">The <code>render_echo</code> program</a><ul><li><a href="#invocation" class="table-of-contents__link">Invocation</a></li><li><a href="#generating-an-echo" class="table-of-contents__link">Generating an echo</a></li><li><a href="#examples" class="table-of-contents__link">Examples</a></li><li><a href="#render_echo-suggested-approach" class="table-of-contents__link"><code>render_echo</code> suggested approach</a></li></ul></li><li><a href="#testing" class="table-of-contents__link">Testing</a><ul><li><a href="#getting-files-to-your-local-computer" class="table-of-contents__link">Getting files to your local computer</a></li><li><a href="#example-files" class="table-of-contents__link">Example files</a></li><li><a href="#song-files" class="table-of-contents__link">Song files</a></li><li><a href="#sound-files" class="table-of-contents__link">Sound files</a></li></ul></li><li><a href="#tips" class="table-of-contents__link">Tips</a><ul><li><a href="#passing-part-of-an-array-to-a-function" class="table-of-contents__link">Passing part of an array to a function</a></li><li><a href="#math-functions" class="table-of-contents__link">Math functions</a></li><li><a href="#converting-command-line-arguments-to-numeric-values" class="table-of-contents__link">Converting command line arguments to numeric values</a></li><li><a href="#use-binary-mode-for-input-and-output" class="table-of-contents__link">Use binary mode for input and output</a></li></ul></li><li><a href="#packaging-and-submission-requirements" class="table-of-contents__link">Packaging and submission requirements</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright Â© 2021 CS220, Johns Hopkins University, Built with Docusaurus.</div></div></div></footer></div>
<script src="/cs220-sp21/styles.d0d6582a.js"></script>
<script src="/cs220-sp21/runtime~main.e22df359.js"></script>
<script src="/cs220-sp21/main.6e648f78.js"></script>
<script src="/cs220-sp21/1.acaf7783.js"></script>
<script src="/cs220-sp21/2.1630dbbf.js"></script>
<script src="/cs220-sp21/76.315a6249.js"></script>
<script src="/cs220-sp21/77.29bcc7d1.js"></script>
<script src="/cs220-sp21/935f2afb.2b8d7949.js"></script>
<script src="/cs220-sp21/17896441.62b1b4c6.js"></script>
<script src="/cs220-sp21/99dc33a9.e1b3604d.js"></script>
</body>
</html>